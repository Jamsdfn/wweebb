# ES6

## ECMAScript ç®€ä»‹

- ECMAScript æ˜¯ JavaScript è¯­è¨€çš„æ ‡å‡†
- ECMA: European Computer Manufacturers Associationï¼ˆæ¬§æ´²è®¡ç®—æœºåˆ¶é€ å•†åä¼šï¼‰
- ECMAScript6ï¼šç®€ç§° ES6ï¼Œæ˜¯ JavaScript è¯­è¨€çš„ä¸‹ä¸€ä»£æ ‡å‡†ï¼Œä¹Ÿæ˜¯ç›®å‰æ­£å¼å‘å¸ƒçš„æœ€æ–°çš„ JavaScript æ ‡å‡†ã€‚ç”±äº ES6 æ˜¯åœ¨ 2015 å¹´å‘å¸ƒçš„ï¼Œæ‰€ä»¥ ES6 ä¹Ÿç§°ä¸º ECMAScript2015ã€‚
- ECMAScript æ˜¯ JavaScript çš„æ ‡å‡†ã€‚JavaScript æ˜¯ EcmaScript çš„å®ç°ï¼Œå°±å¥½åƒã€‚å½“ç„¶ï¼Œé™¤äº† JavaScriptï¼ŒEcmaScript è¿˜æœ‰å…¶ä»–çš„å®ç°ï¼Œæ¯”å¦‚ JScriptã€ActionScriptã€‚
- æœ¬æ–‡æ¡£å‚è€ƒä¹¦ç± http://es6.ruanyifeng.com/

## è¿è¡Œ ECMAScript çš„æ–¹æ³•

- æµè§ˆå™¨ ï¼ˆéƒ½æ˜¯åªæ”¯æŒéƒ¨åˆ† ES6 ä»£ç ï¼Œæœ‰çš„æ”¯æŒçš„å¤šï¼Œæœ‰çš„æ”¯æŒçš„å°‘ï¼‰
  - å„å¤§æµè§ˆå™¨çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¯¹ ES6 çš„æ”¯æŒå¯ä»¥æŸ¥çœ‹ [kangax.github.io/compat-table/es6/](https://kangax.github.io/compat-table/es6/) ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ”¯æŒåº¦å·²ç»è¶Šæ¥è¶Šé«˜äº†ï¼Œè¶…è¿‡ 90%çš„ ES6 è¯­æ³•ç‰¹æ€§éƒ½å®ç°äº†ã€‚
- ä½¿ç”¨ JavaScript å¼•æ“çš„ç³»ç»Ÿ ï¼ˆå¦‚ Node.jsï¼‰
- å°† ECMAScript6 è½¬åŒ–ä¸º EcmaScript5
  - Babel è½¬æ¢å™¨ï¼ˆReact Native å°±æ˜¯ä½¿ç”¨ Babel å°† JSX è½¬æ¢ä¸º JavaScript ä»£ç ï¼‰
  - Traceur è½¬æ¢å™¨
  - webpack ç›´æ¥æ‰“åŒ…ï¼ˆæœ¬è´¨ä¸Šä¹Ÿæ˜¯ç”¨ä¸Šé¢ä¸¤ä¸ªè½¬æ¢å™¨ï¼‰

### å®‰è£… Babel

- å®˜ç½‘ï¼šhttps://babeljs.io/

  ```shell
  npm i -D babel-core babel-preset-es2015 babel-cli
  ```

- å®˜ç½‘åœ¨çº¿ç¼–è¯‘ï¼šhttps://babeljs.io/repl

- åˆ›å»º .babelrc æ–‡ä»¶

  - ```json
    {
      "presets": [
        "es2015"
      ],
      "plugins": [
      ]
    }
    ```

### ES6 è½¬åŒ–ä¸º ES5 çš„æ–¹å¼ï¼ˆbabelï¼‰

- é™æ€è½¬æ¢

  - å­—ç¬¦ä¸²è½¬æ¢

  ```js
  var code = 'let x = n => n + 1'
  var es5Code = require('babel-core').transform(code,{presets: es2015}).code
  ```

  - æ–‡ä»¶è¯»å–è½¬æ¢

  ```js
  var babel = require('babel-core');
  // æ–‡ä»¶è½¬ç ï¼ˆå¼‚æ­¥ï¼‰
  babel.transformFile('filename.js', options, function(err, result) {
    result; // => { code, map, ast }
  });
  
  // æ–‡ä»¶è½¬ç ï¼ˆåŒæ­¥ï¼‰
  babel.transformFileSync('filename.js', options);
  // => { code, map, ast }
  ```

  - ç›´æ¥è¿›è¡Œæ–‡ä»¶è½¬æ¢(å‰ææ˜¯npm i babel-core)

  ```shell
  ./node_module/.bon/babel es6.js -o es5.js
  ```

  - å®˜ç½‘åœ¨çº¿ç¼–è¯‘
    - https://babeljs.io/repl

- åŠ¨æ€è½¬æ¢(ä¸æ¨èï¼Œåœ¨å®¢æˆ·ç«¯æ‰è§£æï¼Œæ¶ˆè€—å¤ªå¤šæ€§èƒ½ï¼Œç”¨æˆ·ä½“éªŒä¸å¥½)

  - ç”¨åˆ° babel-standalone æ’ä»¶

  - `npm install --save react react-dom @babel/standalone`

  - ```html
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>demo</title>
      <script src="node_modules/@babel/standalone/babel.js"></script>
    </head>
    <body>
      <div id="root"></div>
      <script type="text/babel">
      	// ES6 code
        let x = n => n + 1;
        console.log(x(3))
      </script>
    </body>
    </html>
    ```

## ES6 è¯­æ³•

### let

let ç±»ä¼¼äº varï¼Œéƒ½æ˜¯ç”¨æ¥å£°æ˜å˜é‡çš„ï¼Œä½†æ˜¯æ‰€å£°æ˜çš„å˜é‡ï¼Œåªåœ¨`let`å‘½ä»¤æ‰€åœ¨çš„ä»£ç å—å†…æœ‰æ•ˆã€‚ 
- letå’Œ var çš„ä½œç”¨åŸŸæ˜¯ä¸åŒçš„
  1. var å¯ä»¥è·¨ä»£ç å—ï¼Œå°±æ˜¯è¯´ï¼Œåœ¨ä»£ç å—å†…éƒ¨å®šä¹‰çš„å˜é‡ï¼Œå¤–éƒ¨ä¹Ÿå¯ä»¥ä½¿ç”¨
  2. let åªåœ¨ä»£ç å—å†…éƒ¨æœ‰æ•ˆï¼Œå¦‚æœè¶…å‡ºä»£ç å—ï¼Œå°±ä¼šæ˜¾ç¤ºå˜é‡ undefined

```js
{
    let a = 100
    var b = 200
    alert(a)
    alert(b)
}
if (typeof a == 'undefined') {
    alert('aæœªå®šä¹‰')
} else if (typeof b == 'undefined') {
    alert('bæœªå®šä¹‰')
}

var a = []
for (var n = 0; n < 10; n++) {
    a[n] = function () {
        console.log(n)
    }
}
a[4]() // 10

var a = []
for (let n = 0; n < 10; n++) {
    a[n] = function () {
        console.log(n)
    }
}
a[4]() // 4 æ¯æ¬¡å¾ªç¯å¯ä»¥éƒ½çœ‹æˆä¸€ä¸ªæ–°çš„ä»£ç å—ï¼Œæ‰€ä»¥æ¯ä¸ª n éƒ½å­˜æ”¾åœ¨ä¸åŒå†…å­˜ä¸­çš„
```

let çš„å®šä¹‰é¡ºåº

- let åªèƒ½å…ˆå®šä¹‰åœ¨ä½¿ç”¨ï¼Œå› ä¸º let å®šä¹‰çš„å˜é‡ä¸ä¼šè¿›è¡Œå˜é‡æå‡ï¼Œæ‰€ä»¥åè¿‡æ¥ç”¨åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸

- var å®šä¹‰çš„å˜é‡å¯ä»¥å…ˆä½¿ç”¨åå®šä¹‰ï¼Œvar å˜é‡æå‡ï¼Œä½†æ˜¯ä½¿ç”¨æ—¶å˜é‡çš„å€¼æ˜¯ undefined

- let åœ¨ä¸€ä¸ªä»£ç å—ä¸­ï¼Œä¸èƒ½é‡å¤å®šä¹‰
  - å¦‚æœä¸€ä¸ªä»£ç å—ä¸­ ç”¨ let å’Œ var åŒæ—¶å®šä¹‰åŒä¸€ä¸ªå˜é‡ï¼Œä¸ä¼šæŠ¥é”™ï¼Œä»¥ let å®šä¹‰çš„ä¸ºå‡†ï¼Œå¤–éƒ¨ä¹Ÿä¸èƒ½è®¿é—®è€…ä¸ªå˜é‡
  - ä½†æ˜¯å¦‚æœåœ¨å‡½æ•°å†…éƒ¨ åŒæ—¶ç”¨ let å’Œ var åŒæ—¶å®šä¹‰åŒä¸€ä¸ªå˜é‡åˆ™ä¼šç›´æ¥æŠ¥é”™
  - å‡½æ•°çš„å½¢å‚å¦‚æœå’Œå‡½æ•°å†…éƒ¨ let å®šä¹‰çš„å˜é‡åŒåä¹Ÿä¼šç›´æ¥æŠ¥é”™

æš‚æ—¶æ€§æ­»åŒº ï¼ˆTemporal dead zoneï¼‰

- å…¶å®ä¹Ÿå°±æ˜¯ let ä¸ä¼šå˜é‡æå‡ï¼Œå¦‚æœå…ˆä½¿ç”¨åˆ™æŠ›å‡ºå¼‚å¸¸çš„è¿™ç§æƒ…å†µ

### å—çº§ä½œç”¨åŸŸ

å—çº§ä½œç”¨åŸŸçš„éœ€æ±‚ï¼šå†…å±‚å˜é‡å¯èƒ½ä¼šè¦†ç›–å¤–å±‚å˜é‡ï¼›å±€éƒ¨å˜é‡æ³„éœ²æˆå…¨å±€å˜é‡ï¼ˆå› ä¸ºå‡½æ•°ä¹Ÿä¼šè¿›è¡Œå‡½æ•°æå‡ï¼Œæ‰€ä»¥å‡½æ•°ä¹Ÿä¼šå‡ºç°å“åº”çš„é—®é¢˜ï¼Œï¼‰ã€‚let çš„å‡ºç°å®é™…ä¸Šå°±æ˜¯ä¸ºäº†ç»™ JavaScript å¢åŠ å—çº§ä½œç”¨åŸŸã€‚

```js
// å†…å±‚å˜é‡è¦†ç›–å¤–å±‚å˜é‡
var s = 'hello world'
var fun = function () {
    console.log(s) // ç”¨ this.s åˆ™ä¼šæ‰¾åˆ° window ä¸‹å…¨å±€çš„ s åˆ™è¾“å‡ºä¼šå˜ä¸º hello world
    if (false) {
        var s = '???' // å³ä½¿ä¸è¢«æ‰§è¡Œï¼Œä½†å› ä¸ºå˜é‡æå‡ï¼Œå†…å±‚sè¿˜æ˜¯è¦†ç›–äº† å¤–å±‚å˜é‡sçš„å€¼
    }
    console.log(s)
}
fun() 
/*
undefined
undefined
*/
// å±€éƒ¨å˜é‡æ³„éœ²æˆå…¨å±€å˜é‡
for (var i = 0; i < 10; i++) {
    
}
console.log(i) // 10
```

- å—çº§ä½œç”¨åŸŸå’ŒåŒ¿åå‡½æ•°

  - å—çº§ä½œç”¨åŸŸå¯ä»¥å–ä»£åŒ¿åå‡½æ•°

  ```js
  (
  	function () {
          var v = 'åŒ¿åå‡½æ•°'
          console.log(v)
      }()
  )
  
  {
      let v = 'å—çº§ä½œç”¨åŸŸ'
      console.log(v)
  }
  ```

### const

const ç”¨äºå£°æ˜å¸¸é‡ï¼Œä¸€æ—¦å£°æ˜ï¼Œå†æ”¹å˜å¸¸é‡çš„å€¼ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¸¸é‡å¿…é¡»åœ¨å£°æ˜æ—¶åˆå§‹åŒ–ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚const å’Œ let ä¸€æ ·ï¼Œåªåœ¨å£°æ˜æ‰€åœ¨çš„å—çº§ä½œç”¨åŸŸæœ‰æ•ˆã€‚var/let å’Œ const ä¸å¯ä»¥åœ¨åŒä¸€ä¸ªå—ä¸­å£°æ˜åŒä¸€ä¸ªå˜é‡ã€‚

- å¯¹è±¡å¸¸é‡
  
  - ç›´æ¥æ”¹å˜å¯¹è±¡å¸¸é‡çš„å±æ€§æ˜¯ä¸å¯ä»¥çš„ï¼Œä½†æ˜¯å¯ä»¥æ”¹å˜å±æ€§çš„å€¼
- æ•°ç»„å¸¸é‡
  
- ä¸å¯ä»¥æŠŠæ•°ç»„çš„æŒ‡é’ˆï¼ˆä¹Ÿå°±æ˜¯æŠŠåŸæ¥çš„æŒ‡é’ˆæŒ‡å‘åˆ«çš„æ•°ç»„ï¼‰ï¼Œä½†å¯ä»¥æ”¹å˜æ•°ç»„å†…å­˜çš„æ•°æ®ï¼Œå³å¯ä»¥å¢åˆ æ”¹æ•°ç»„å…ƒç´ 
  
- å†»ç»“å¯¹è±¡
  - è®©å¯¹è±¡å¸¸é‡çš„å±æ€§å’Œå±æ€§çš„å€¼éƒ½ä¸èƒ½æ”¹å˜
  - `const obj = Object.freeze({name: "name"}) `
  - å¦‚æœæ”¹å˜ obj.name å³ `obj.name = 'kite'` ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯è¿™æ ·å¹¶ä¸ä¼šæ”¹å˜åŸæ¥å±æ€§çš„å€¼ï¼Œå³ name è¿˜æ˜¯ nameã€‚å› ä¸ºæ•°ç»„ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨æ¬¡æ–¹æ³•å†»ç»“æ•°ç»„ï¼ˆæ³¨æ„ä¸€ç‚¹ï¼šå’Œå†»ç»“å¯¹è±¡æœ‰ç‚¹ä¸åŒï¼Œå¦‚æœæ”¹å˜å·²å†»ç»“æ•°ç»„çš„é•¿åº¦ï¼Œåˆ™ä¼šæŠ¥é”™ï¼‰

- æ·±åº¦å†»ç»“å¯¹è±¡

  - å› ä¸ºå¯¹è±¡å¯èƒ½å±æ€§çš„å€¼ä¹Ÿå¯ä»¥æ˜¯ä¸ªå¯¹è±¡ï¼Œç”¨å†»ç»“å¯¹è±¡çš„æ–¹å¼åªèƒ½å†»ç»“ç¬¬ä¸€å±‚å±æ€§
  - è¿™å°±è¦è‡ªå·±ç”¨é€’å½’å†™ä¸€ä¸ªæ–¹æ³•

  ```js
  var depthFreezeObject = (obj) => {
      obj = Object.freeze(obj)
      Object.keys(obj).forEach((key => {
          if (typeof obj[key] == 'object') {
              depthFreezeObject(obj[key])
          }
      })
      return obj
  }
  ```


### å˜é‡çš„è§£æ„ï¼ˆDestructuringï¼‰

ES6 å…è®¸æŒ‰ç…§ä¸€å®šæ¨¡å¼ï¼Œä»æ•°ç»„å’Œå¯¹è±¡ä¸­æå–å€¼ï¼Œå¯¹å˜é‡è¿›è¡Œèµ‹å€¼ï¼Œè¿™è¢«ç§°ä¸ºè§£æ„ï¼ˆDestructuringï¼‰ã€‚å…¶å®å°±æ˜¯ä¸€ç§æ–°çš„é˜Ÿå˜é‡çš„èµ‹å€¼æ–¹å¼ã€‚

- æ•°ç»„çš„è§£æ„èµ‹å€¼
  - å®šä¹‰æ—¶è§£æ„èµ‹å€¼
  - åæœŸè§£æ„èµ‹å€¼
  - åµŒå¥—è§£æ„èµ‹å€¼
  - Generator å‡½æ•°çš„è§£æ„èµ‹å€¼
- å¯¹è±¡çš„è§£æ„èµ‹å€¼
  - å˜é‡å½¢å¼çš„èµ‹å€¼
  - å¯¹è±¡å½¢å¼çš„èµ‹å€¼
  - æ··åˆå½¢å¼çš„èµ‹å€¼
  - å˜é‡çš„é‡å¤å£°æ˜

#### æ•°ç»„çš„è§£æ„èµ‹å€¼

è§£æ„éœ€è¦è¿›è¡Œæ¨¡å¼çš„åŒ¹é… (å³å¦‚æœå½¢å¼ä¸€æ ·å°±ç»™å˜é‡ä¾æ¬¡èµ‹å€¼)ã€‚åªè¦æŸç§æ•°æ®ç»“æ„å…·æœ‰ Iterator æ¥å£ï¼Œéƒ½å¯ä»¥é‡‡ç”¨æ•°æ®å½¢å¼çš„è§£æ„èµ‹å€¼ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡ï¼Œéƒ½ä¼šæŒ‡å‘ yield è¯­å¥ï¼ˆç¬¬äºŒå¥è¯å¯èƒ½åˆšäº†è§£ ES6 å¯èƒ½çœ‹ä¸æ‡‚ï¼Œä½†æœ¬æ–‡ä¼šæœ‰ç›¸åº”çš„éƒ¨åˆ†è¿›è¡Œè¯¦ç»†è®²è§£ï¼‰ã€‚


- å®šä¹‰æ—¶è§£æ„èµ‹å€¼

  - è§£æ„çš„æ•°ç»„å½¢å¼ï¼Œå°±æ˜¯ç”¨æ•°ç»„çš„æ–¹å¼ç»™å˜é‡è¿›è¡ŒåŒæ—¶èµ‹å€¼
    

  ```js
  // æ™®é€šçš„èµ‹å€¼æ–¹å¼
  var x = 1
var y = 2
  var z = 3
  //  å®šä¹‰æ—¶è§£æ„èµ‹å€¼
  let [a, b, c] = [4, 5, 6]
  console.log('a = ' + a)
  console.log('b = ' + b)
  console.log('c = ' + c)
  ```
  
- åæœŸè§£æ„èµ‹å€¼

  ```js
    // æ™®é€šçš„èµ‹å€¼æ–¹å¼
    var x = 1
    var y = 2
    var z = 3
    // åæœŸè§£æ„èµ‹å€¼
    ;[x, y, z] = [10, 20, 30]
    console.log('x = ' + x)
    console.log('y = ' + y)
    console.log('z = ' + z)
  ```

- åµŒå¥—è§£æ„èµ‹å€¼

  ```js
  let [age, [salary, [name]]] = [20, [3000, ['Sill']]]
  // ä¸‹é¢æ–¹æ³•çš„èµ‹å€¼æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºå½¢å¼æ²¡æœ‰åŒ¹é…
  // let [age, [salary, [name]]] = [20, 3000, 'Sill']
  console.log('age = ' + age)
  console.log('salary = ' + salary)
  console.log('name = ' + name)
  ```

- è‹¥æ²¡æœ‰å¯¹åº”çš„åŒ¹é…å€¼åˆ™ä½åŒ¹é…åˆ°çš„å€¼ä¸º undefinedï¼ˆä¸ä¼šæŠ¥é”™ï¼‰

  ```js
  let [m, n] = ['a']
  console.log('m = ' + m) // m = a
  console.log('n = ' + n) // n = undefined
  ```

- éƒ¨åˆ†åŒ¹é…åˆ™å¤šå‡ºæ¥å€¼çš„è¢«å¿½ç•¥äº†ï¼ˆä¸ä¼šæŠ¥é”™ï¼‰

  ```js
  let [m, n] = ['a', 'b', 'c']
  console.log('m = ' + m) // m = a
  console.log('n = ' + n) // n = b
  ```

- åŒ¹é…å‰©ä½™çš„å€¼

  ```js
  // å¦‚æœè¿™æ ·è§£æ„èµ‹å€¼ï¼Œåˆ™våˆ™å˜ä¸ºä¸€ä¸ªæ•°ç»„å­˜æ”¾å‰©ä½™çš„æ‰€æœ‰å€¼
  let [m, n, ...v] = ['a', 'b', 'c', 'd', 'e', 'f']
  ```

- åŒ¹é…ä¸æˆåŠŸåˆ™ç›´æ¥æŠ¥é”™

  ```js
  let [v1] = 12 //ç›´æ¥æŠ¥é”™
  ```

- Generator å‡½æ•°çš„è§£æ„èµ‹å€¼ï¼ˆåæ–‡ä¼šè¯¦ç»†è®²è§£ Generator å‡½æ•°ï¼‰

  ```js
  // Generator å‡½æ•°ï¼Œå¤©ç”Ÿå…·æœ‰ Iterator æ¥å£ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œè§£æ„
  // Generator ä¼šæ²¡è°ƒç”¨ä¸€æ¬¡ï¼Œä¼šæš‚åœï¼Œæ‰€ä»¥ä¸‹é¢çš„æ–¹æ³•ä¸ä¼šæ— é™å¾ªç¯
  let gen = function* (x) {
      while (true) {
          yield x 	// ç¬¬ä¸€æ¬¡ 10 ç¬¬äºŒæ¬¡ 12 ç¬¬ä¸‰æ¬¡ 14
          x = x + 2 // ç¬¬ä¸€æ¬¡ 12 ç¬¬äºŒæ¬¡ 14 ç¬¬ä¸‰æ¬¡ 16
      }
  }
  // æ­£å¦‚å¼€å¤´è¯´çš„ï¼Œå› ä¸ºæŒ‡å‘çš„æ˜¯yieldï¼Œæ‰€ä»¥ç»“æœå¦‚ä¸‹æ‰€ç¤º
  let [g1, g2 ,g3] = gen(10)
  console.log('g1 = ' + g1) // g1 = 10
  console.log('g2 = ' + g2) // g2 = 12
  console.log('g3 = ' + g3) // g3 = 14
  ```

- è§£æ„èµ‹å€¼çš„é»˜è®¤å€¼

  ```js
  let [name1] = []
  console.log('name1 = ' + name1) // name1 = undefined
  let [name2 = 'Bill'] = []
  console.log('name1 = ' + name2) // name2 = Bill
  let f = function () {
      console.log('f')
      return 'hello'
  }
  let ff = function () {
      console.log('ff')
  }
  let [f1 = f(), f2 = ff(), f3 = f] = []// f ff è¿™æ˜¯å‡½æ•°ç›´æ¥è°ƒåŠ¨çš„ç»“æœ
  console.log('f1 = ' + f1)// f1 = hello
  console.log('f2 = ' + f2)// f2 = undefined å› ä¸ºffå‡½æ•°æ²¡æœ‰è¿”å›å€¼
  console.log('f3 = ' + f3)// f3 =  let f = function () { è¿™æ ·ä¼šç›´æ¥è¾“å‡ºå‡½æ•°ä½“
  //    								console.log('f')
  //     								return 'hello'
  // 								}
  let [xx = yy, yy = 20] = [] // ç›´æ¥æŠ¥é”™ï¼ˆæš‚æ—¶æ€§æ­»åŒºï¼Œå› ä¸º xx å®šä¹‰æ—¶ yy è¿˜æ²¡æœ‰å®šä¹‰ï¼‰
  ```

#### å¯¹è±¡çš„è§£æ„èµ‹å€¼

- å˜é‡å½¢å¼çš„èµ‹å€¼

  ```js
    var {name3, age1} = {age1: 30, name3: 'Bill'} // å› ä¸ºæœ‰é”®å€¼å¯¹çš„å…³ç³»ï¼Œæ‰€ä»¥é¡ºåºå¯ä»¥æ‰“ä¹±
    console.log(name3,age1) // Bill 30
  
    var {value1, value2} = {value1: 30} 
    console.log(value1, value2) // 30 undefined
  
    let { baz } = { foo: 'aaa', bar: 'bbb' }
    console.log(baz) // undefined
  ```

- å¯¹è±¡å½¢å¼çš„èµ‹å€¼

  ```js
  var {product: a1, price: b1} = {product:'phone', price:'666'}
  console.log('a1 = ' + a1, 'b1 = ' +b1)// a1 = phone b1 = 666
  let { foo: baz } = { foo: 'aaa', baz: 'bbb' };
  // ç›¸å½“äº = åé¢{}çš„ foo çš„å€¼ ç»™äº† = å‰é¢{}çš„ baz
  console.log('foo = ' + foo, 'baz = ' + baz)
  // foo error:foo is not defined; baz  aaa
  ```

- æ··åˆå½¢å¼çš„èµ‹å€¼

  ```js
  var {product: a2, price1} = {product: 'pen', price1: 777}
  console.log('a2 = ' + a2, 'price1 = ' + price1) // a2 = pen price1 = 777
  ```

- å˜é‡å½¢å¼çš„é‡å¤èµ‹å€¼ï¼Œä¼šæŠ¥é”™

  ```js
  let {v1, v2} = {v1: 20, v2: 30}
  let v1 = 50 // ç›´æ¥æŠ¥é”™ï¼ˆlet çš„é‡å¤å®šä¹‰ï¼‰
  ```
  
- åµŒå¥—èµ‹å€¼

  ```js
  var obj = {p: ['hello', {x: 100}]}
  var {p: [s, {x:y}]} = obj
  console.log('s = ' + s)// s = hello
  console.log('y = ' + y)// y = 100
  ```

- é»˜è®¤å€¼

  ```js
  var {x = 4} = {}
  console.log('x = ' + x)// 4
  var {message: msg = 'hello'} = {}
  console.log('msg = ' + msg)// msg = hello
  ```

- åæœŸèµ‹å€¼çš„æ–¹å¼

  ```js
  var x
  var y
  x = 30
  // js ç¼–è¯‘å™¨ä¼šæŠŠæ²¡æœ‰ var let const å£°æ˜çš„{}ï¼Œå½“æˆæ˜¯ä»£ç å—ï¼Œè€Œä¸æ˜¯å˜é‡ç»„
  {x, y} = {x:20, y:30}// æŠ¥é”™
  // ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥åœ¨è¿™ä¸ªå¤–é¢åŠ ä¸€ä¸ª()
  ;({x, y} = {x:20, y:30})// èµ‹å€¼æˆåŠŸ
  ```

- å¯¹è±¡æ–¹æ³•èµ‹å€¼

  ```js
  let {sin, cos} = Math // å…¶å®å°±æ˜¯æŠŠ Math.sin å’Œ Math.cos ä¸¤ä¸ªæ–¹æ³•èµ‹å€¼ç»™äº† sin å’Œ cos
  console.log('cos(Ï€) = ' + cos(Math.PI))// cos(Ï€) = -1
  ```
```
  

#### å­—ç¬¦ä¸²ã€æ•°å€¼å’Œå¸ƒå°”å€¼çš„è§£æ„èµ‹å€¼

- å­—ç¬¦ä¸²çš„è§£æ„èµ‹å€¼

  ```js
  let [a, b, c, d, e] = 'hello'
  console.log(a, b, c, d, e)// h e l l o
  const {length:len} = 'How are you?'
  console.log(len)// 12
```

- æ•°å€¼çš„è§£æ„èµ‹å€¼

  ```js
  // æ•°å€¼çš„è§£æ„å›ºæ‰§ ï¼ˆå¦‚æœ = å³ä¾§ä¸æ˜¯å¯¹è±¡ï¼Œç³»ç»Ÿä¼šå°†å…¶è½¬åŒ–ä¸ºå¯¹è±¡ï¼Œç„¶ååœ¨è§£æ„ï¼‰
  let {toString: s} = 456
  if (s === Number.prototype.toString) {
      console.log('s === Number.prototype.toString')
  }
  ```

- å¸ƒå°”å€¼çš„è§£æ„èµ‹å€¼

  ```js
  let {toString: s} = true
  if (s === Boolean.prototype.toString) {
      console.log('s === Boolean.prototype.toString')
  }
  ```

- å› ä¸º undefined å’Œ null æ— æ³•è½¬åŒ–ä¸ºå¯¹è±¡ï¼Œæ‰€ä»¥æ— æ³•è§£æ„

#### å‡½æ•°å‚æ•°çš„è§£æ„èµ‹å€¼

ä¸»è¦ç”¨äºåŠ¨æ€å‡½æ•°ï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰æ²¡ä»€ä¹ˆç”¨ å› ä¸º js å‡½æ•°ä½“æœ¬èº«å°±å¯ä»¥é€šè¿‡ arguments å¯¹è±¡æ¥æ¥å—åŠ¨æ€å‚æ•°ï¼Œå¦‚æœä¸æ˜¯åŠ¨æ€å‚æ•°å°±æ›´ä¸å¿…è¦äº†ã€‚

```js
var foo = function ([...v]) {
    v.map(x => console.log(x))
}
foo([1,2,3,4,5])
```

### å˜é‡è§£æ„çš„åº”ç”¨

- å˜é‡äº¤æ¢

  ```js
  var m = 1
  var n = 2
  ;[m, n] = [n, m]
  console.log("m = " + m)// m = 2 
  console.log("n = " + n)// n = 1
  ```

- å‡½æ•°è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶å°†è¿”å›ç»“æœèµ‹ç»™å¤šä¸ªå˜é‡

  ```js
  var multiNames = function () {
      return ['Bill', 'Mike', 'John']
  }
  var [name11, name22, name33] = multiNames()
  console.log('name11 = ' + name11)// name11 = Bill
  console.log('name22 = ' + name22)// name22 = Mike
  console.log('name33 = ' + name33)// name33 = John
  ```

- ä½¿ç”¨å¯¹è±¡å½¢å¼çš„å‚æ•°ï¼Œå¯ä»¥æ— åºä¼ é€’å‚æ•°

  ```js
  var sub = function ({x, y, z}) {
      return x - y - z
  }
  console.log(sub({z: 20, y:-15, x:10}))// 5
  ```

- å‡½æ•°å‚æ•°å¯ä»¥ä½¿ç”¨é»˜è®¤å€¼

- éå† Map æ•°æ®ç»“æ„

  - ```js
    //mapæ˜¯ESæä¾›çš„ä¸€ç§å­—å…¸æ•°æ®ç»“æ„ã€‚
    
    //å­—å…¸ç»“æ„â€”â€”ç”¨æ¥å­˜å‚¨ä¸é‡å¤keyçš„hashç»“æ„ã€‚ä¸åŒäºé›†åˆï¼ˆsetï¼‰çš„æ˜¯ï¼Œå­—å…¸ä½¿ç”¨çš„æ˜¯é”®å€¼å¯¹çš„å½¢å¼æ¥å­˜å‚¨æ•°æ®
    
    //JavaScriptå¯¹è±¡ï¼ˆobjectï¼š{}ï¼‰åªèƒ½ç”¨å­—ç¬¦ä¸²æ¥å½“keyï¼Œè¿™å¯¹ä½¿ç”¨å¸¦æ¥äº†ä¸ä¾¿
    
    //ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒES6æä¾›äº†mapæ•°æ®ç»“æ„ã€‚å…¶ç±»ä¼¼äºå¯¹è±¡ï¼Œä¹Ÿæ˜¯é”®å€¼å¯¹çš„é›†åˆï¼Œä½†â€œkeyâ€çš„èŒƒå›´ä¸ä»…é™äºå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯å„ç§ç±»å‹çš„å€¼éƒ½å¯ä»¥å½“åškeyã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œobjectæä¾›äº†â€œå­—ç¬¦ä¸²-å€¼â€çš„å¯¹åº”ç»“æ„ï¼Œmapåˆ™æä¾›çš„æ˜¯â€œå€¼-å€¼â€çš„å¯¹åº”ã€‚æ˜¯ä¸€ç§æ›´åŠ å®Œå–„çš„hashç»“æ„
    const map=new Map([
         ['a',1],
         ['b',2]
    ]);
    console.log(map);
    ```
  
  - ä»»ä½•éƒ¨ç½²äº† Iterator æ¥å£çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ forâ€¦ofå¾ªç¯å˜é‡
  
  - Map ç»“æ„åŸç”Ÿæ”¯æŒ Iterator æ¥å£
  
  ```js
  var map = new Map()
  map.set('id', 49)
  map.set('name', 'John')
  map.set('age', 20)
  for (let [key, value] of map) {
      console.log(key + ': ' + value)
  }
  ```

### å­—ç¬¦ä¸²çš„æ‰©å±•

- å­—ç¬¦çš„ Unicode è¡¨ç¤ºæ³•

  - Unicode æ˜¯ä¸€ç§å­—ç¬¦çš„ç¼–ç æ–¹å¼ï¼Œå¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦å¯¹åº”æˆä¸€ä¸ªæ•°å­—
  - js ä¸­ç”¨ \uxxxx è¡¨ç¤º Unicode ç¼–ç ï¼Œx ä¸º16è¿›åˆ¶æ•°å­— \u0000 ~ \uFFFF

  ```js
  var s = 'ä¸­'
  // string.charCodeAt(0), è¿”å›å€¼æ˜¯10è¿›åˆ¶ç¼–ç ï¼Œå‚æ•°ä¸ºå­—ç¬¦ä¸²çš„ç¬¬å‡ ä¸ªå­—ç¬¦
  // .toString(16), è¡¨ç¤ºè½¬ä¸º16è¿›åˆ¶ç¼–ç 
  console.log('ä¸­: ' + s.charCodeAt(0).toString(16)) // 4e2d
  console.log('\u4e2d') // ä¸­
  // å¦‚æœæ˜¯ Unicode2 åˆ™è¦ç”¨ ES6 æ–°å¢çš„ \u{xxxxx}
  console.log('\u{1f412}')// ğŸ’
  var ss = 'ğŸ’' // æ­¤å¤„çš„ ğŸ’ æ˜¯ utf-16 ç¼–ç 
  // å› ä¸º utf-16 å­—ç¬¦ä¸²é•¿åº¦ä¸º 2ï¼Œä¸¤æ¬¡è¾“å‡ºæ‰æ˜¯è¿™ä¸ªå®Œæ•´çš„å­—ç¬¦
  console.log('ğŸ’: ' + ss.charCodeAt(0).toString(16))// ğŸ’: d83d
  console.log('ğŸ’: ' + ss.charCodeAt(1).toString(16))// ğŸ’: dc12
  console.log('\ud83d\udc12')// ğŸ’ æ­¤å¤„çš„ utf-16 å’Œ Unicode2 ç›¸å¯¹åº”
  console.log('ğŸ’: ' + ss.codePointAt(0).toString(16))// ğŸ’: 1f412 ç›´æ¥è·å¾— Unicode2 ç¼–ç 
  ```

- String.fromCodePoint

  ```js
  // å¯¹ ES5 çš„ String.fromCharCode() çš„è¡¥å……ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•åªèƒ½é€‚ç”¨äº Unicode1ï¼Œ
  console.log(String.fromCharCode(0x9f99))// é¾™
  console.log(String.fromCharCode(0x1f412))// ï’
  // å¯¹ Unicode2 ä¹Ÿæ”¯æŒ
  console.log(String.fromCodePoint(0x9f99))// é¾™
  console.log(String.fromCodePoint(0x1f412))// ğŸ’
  ```

- å­—ç¬¦ä¸²çš„éå†å™¨æ¥å£

  - ES6 ä¸ºå­—ç¬¦ä¸²æ·»åŠ äº†éå†å™¨æ¥å£ï¼Œä½¿å­—ç¬¦ä¸²å¯ä»¥ç”± forâ€¦of å¾ªç¯éå†

  ```js
  var text = 'ğŸ’é¾™'
  for (let c of text) {
      console.log(c)
  }
  // ğŸ’
  // é¾™
  ```

- åœ¨å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾å­å­—ç¬¦ä¸²

  ```js
  // ES5 indexOf
  // ä»ç¬¬0ä½å¼€å§‹æŸ¥æ‰¾ 'cd',ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®
  console.log('cdabcde'.indexOf('cd',0))// 0
  // ä»ç¬¬1ä½å¼€å§‹æŸ¥æ‰¾ 'cd'
  console.log('cdabcde'.indexOf('cd',1))// 4
  // ES6
  // includes() è¿”å›å€¼ä¸ºå¸ƒå°”ç±»å‹ï¼Œç”¨äºåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨äºåŸå­—ç¬¦ä¸²
  console.log('cdabcde'.includes('cd'))// true
  console.log('cdabcde'.includes('cdf'))// false
  // startsWith() è¿”å›å€¼ä¸ºå¸ƒå°”ç±»å‹ï¼Œç”¨äºåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŸå­—ç¬¦ä¸²å¼€å¤´
  console.log('cdabcde'.startsWith('cd'))// true
  console.log('cdabcde'.startsWith('ccd'))// false
  // endsWith() è¿”å›å€¼ä¸ºå¸ƒå°”ç±»å‹ï¼Œç”¨äºåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŸå­—ç¬¦ä¸²ç»“å°¾
  console.log('cdabcde'.endsWith('cd'))// false
  console.log('cdabcde'.endsWith('de'))// true
  ```

- å°†åŸå­—ç¬¦ä¸²é‡å¤ n æ¬¡

  ```js
  // repeat() å°†ä¸€ä¸ªå­—ç¬¦ä¸²é‡å¤ n æ¬¡
  // å¦‚æœå‚æ•°æ˜¯0ï¼Œåˆ™è¾“å‡ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼›å¦‚æœå‚æ•°æ˜¯æµ®ç‚¹æ•°ï¼Œåˆ™èˆå»å°æ•°éƒ¨åˆ†ç›´æ¥å–æ•´ï¼›å¦‚æœå‚æ•°æ˜¯è´Ÿæ•°æˆ–Infinityï¼ˆæ— ç©·ï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºé”™è¯¯ï¼›å¦‚æœå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¦‚æœå­—ç¬¦ä¸²æ˜¯çº¯æ•°å­—ï¼Œåˆ™ä¼šé‡å¤næ¬¡ï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸æ˜¯çº¯æ•°å­—åˆ™è¾“å‡ºç©ºå­—ç¬¦ä¸²
  console.log('x'.repeat(5))
  ```
  
- æ¨¡æ¿å­—ç¬¦ä¸²

  - ç”¨ ` åŒ…è£¹çš„å­—ç¬¦ä¸²ï¼Œå…¶å¯ä»¥ä¿ç•™å­—ç¬¦ä¸²çš„æ ¼å¼

  ```js
  console.log(`hello
  	world`)
  //è¾“å‡ºå¦‚ä¸‹
  hello
       world
  ```

  - ä¹Ÿå¯ä»¥åœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡ ${}ï¼Œå¤§æ‹¬å·ä¸­å¯ä»¥æ”¾ä»»ä½•è¡¨è¾¾å¼ï¼Œå¯ä»¥è¿›è¡Œè¿ç®—ï¼Œä¹Ÿå¯ä»¥æ”¾å‡½æ•°

  ```js
  var name = 'Bill'
  console.log(`name = ${name}`)// name = Bill
  var x = 10
  var y = 20
  console.log(`${x} + ${y} = ${x + y}`)// 10 + 20 = 30
  var wow = function () {
      return 'wow function'
  }
  console.log(`${wow()}`)// wow function
  ```

- æ ‡ç­¾æ¨¡æ¿

  - å‡½æ•°çš„ä¸€ç§ç‰¹æ®Šè°ƒç”¨å½¢å¼

  ```js
  var x = 1
  var y = 2
  var fun = function (s, n, m) {
      console.log(s)// ["abc", "def", "ccc"]
      console.log(n)// 1
      console.log(m)// 2
  }
  fun`abc${x}def${y}ccc`
  // éæ¨¡æ¿å­—ç¬¦ä¸²æ–¹å¼æ”¾å…¥ç¬¬ä¸€ä¸ªå‚æ•°(æ¨¡æ¿å˜é‡èµ·åˆ†å‰²ç¬¦ä½œç”¨)ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„å˜é‡å½“åšå¦å¤–çš„å‚æ•°ï¼Œæ¨¡æ¿å˜é‡å°‘äº†åˆ™å‡½æ•°åé¢ç¼ºçš„å‚æ•°ä¸º undefinedï¼›æ¨¡æ¿å˜é‡å¤šäº†ï¼Œåˆ™å¤šçš„éƒ¨åˆ†èˆå»ä¸ç”¨ï¼Œä¸ä¼šæŠ¥é”™
  ```

  - ç”¨äºè¿‡æ»¤ HTML å­—ç¬¦ä¸²ï¼Œå°±æ˜¯æŠŠé¡µé¢ä¸èƒ½ç›´æ¥æ˜¾ç¤ºçš„ < > ç©ºæ ¼ æ”¹ä¸º html çš„è¾“å‡ºæ–¹å¼

  ```js
  function SaferHTML(templateData) {
    let s = templateData[0];
    for (let i = 1; i < arguments.length; i++) {
      let arg = String(arguments[i]);
  
      s += arg.replace(/&/g, "&amp;")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;")
  
      s += templateData[i];
    }
    return s;
  }
  var sender = '<script>'
  var message = SaferHTML`<p>${sender}</p>`// <p>&lt;script&gt;</p> domå…ƒç´ å°±å¯ä»¥ç›´æ¥ç”¨äº†
  ```

- String.raw æ–¹æ³•

  - ç›´æ¥è¾“å‡ºæœ€åŸå§‹çš„å­—ç¬¦ä¸²
  - è¿™ä¸ªå‡½æ•°å¯ä»¥è¯´æ˜¯ç»™æ¨¡æ¿å­—ç¬¦ä¸²è®¾è®¡çš„ï¼Œå› ä¸ºå‚æ•°ååˆ†å¤æ‚ï¼Œå¦‚æœç”¨æ™®é€šçš„è°ƒç”¨ä¼šååˆ†çš„å¤æ‚ï¼Œä½†æ˜¯å¾ˆç¬¦åˆç”¨æ ‡ç­¾æ¨¡æ¿çš„æ–¹å¼è°ƒç”¨çš„æ–¹å¼

  ```js
  console.log('abc \n xyz')
  // è¾“å‡ºå¦‚ä¸‹
  abc 
   xyz
   
   console.log(String.raw`abc \n xyz`)// abc \n xyz
  
  // æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿè®¸ä¸éœ€è¦å°† String.raw() å½“ä½œå‡½æ•°è°ƒç”¨ã€‚å¯ä»¥ç†è§£ä¸ºrawæ•°ç»„å’Œåé¢çš„å‚æ•°äº¤æ›¿è¾“å‡º
  // ä½†æ˜¯ä¸ºäº†æ¨¡æ‹Ÿ `t${0}e${1}s${2}t` ä½ å¯ä»¥è¿™æ ·åš:
  String.raw({ raw: 'test' }, 0, 1, 2); // 't0e1s2t'
  // æ³¨æ„è¿™ä¸ªæµ‹è¯•, ä¼ å…¥ä¸€ä¸ª string, å’Œä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡
  // ä¸‹é¢è¿™ä¸ªå‡½æ•°å’Œ `foo${2 + 3}bar${'Java' + 'Script'}baz` æ˜¯ç›¸ç­‰çš„.
  String.raw({
    raw: ['foo', 'bar', 'baz'] 
  }, 2 + 3, 'Java' + 'Script'); // 'foo5barJavaScriptbaz'
  ```


### æ•°å€¼çš„æ‰©å±•

- æ–°çš„äºŒè¿›åˆ¶å’Œå…«è¿›åˆ¶è¡¨ç¤ºæ³•

  - äºŒè¿›åˆ¶ï¼š0b/0B
  - å…«è¿›åˆ¶ï¼š0o/0O

  ```js
  var n1 = 345
  var n2 = 0o531
  var n3 = 0b101011001
  if (n1 == n2) {
      console.log('n1 == n2')
  }
  // n1 == n2
  if (n3 == n2) {
      console.log('n3 == n2')
  }
  // n2 == n3
  
  //å°†äºŒè¿›åˆ¶å’Œå…«è¿›åˆ¶è½¬å›åè¿›åˆ¶
  console.log(Number('0o531'))// 345
  console.log(Number('0b101011001'))// 345
  ```

- Number.isFinite å’Œ Number.isNaN

  ```js
  // ES6 æä¾›äº†è¿™ä¸¤ä¸ªæ–¹æ³•æ¥åˆ¤æ–­æ•°å€¼æ˜¯å¦æ˜¯ æœ‰é™å€¼ å’Œ NaNï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ Number å¯¹è±¡çš„ï¼Œæ‰€ä»¥æ‰€æœ‰éæ•°å€¼å‚æ•°ä¼ å‚éƒ½è¿”å›false
  console.log(Number.isFinite(20))// true
  console.log(Number.isFinite(Infinity))// false
  console.log(Number.isFinite(NaN))// false
  console.log(Number.isFinite('20'))// false
  
  console.log(Number.isNaN(20))// false
  console.log(Number.isNaN(Infinity))// false
  console.log(Number.isNaN(NaN))// true
  console.log(Number.isNaN(20/NaN))// true
  console.log(Number.isNaN('20'/'2'))// false (å› ä¸ºè¿›è¡Œè¿ç®—è‡ªåŠ¨è½¬ä¸ºäº†æ•°å­—ï¼Œæ‰€ä»¥æ˜¯ false)
  console.log(Number.isNaN('a'))// false (éæ•°å€¼)
  console.log(Number.isNaN('a'/1))// true (å¯¹éæ•°å­—å­—ç¬¦ä¸²è¿›è¡Œè¿ç®—ï¼Œæ‰€ä»¥æ˜¯ NaN)
  console.log(Number.isNaN('a'/'b'))// true (åŒä¸Š)
  ```
  
- Number.parseInt ã€Number.parseFloat ã€Number.isInteger

  - å‰ä¸¤ä¸ªæ–¹æ³•å’Œ ES5 çš„å…¨å±€æ–¹æ³•ä¿æŒä¸€è‡´ï¼Œä½†æ˜¯ `Number.isInterger` æ–¹æ³•éæ•°å€¼ä½œä¸ºå‚æ•°ä¼ å‚ç›´æ¥è¿”å› false

- Number.EPSILON (æå°å€¼)

  - å› ä¸ºå‰ç«¯å¯¹æµ®ç‚¹æ•°çš„è¿ç®—éƒ½æ˜¯æœ‰è¯¯å·®çš„ï¼Œæ‰€ä»¥å¼•å…¥äº†è¿™ä¸ªæå°å€¼æ¥æ¶ˆé™¤è¯¯å·®

  ```js
  console.log(0.1 + 0.2) // 0.30000000000000004
  // æ‰€ä»¥ç”¨å‰ç«¯åˆ¤æ–­æµ®ç‚¹æ•°æ˜¯æœ‰é—®é¢˜çš„
  console.log(0.1 + 0.2 == 0.3) // false
  console.log(((0.1 + 0.2)-0.3) < Number.EPSILON) // true åšå·®åå°äºæå°å€¼ï¼Œè¿‘ä¼¼ç›¸ç­‰
  ```

### Mathå¯¹è±¡çš„æ‰©å±•

- Math.trunc  

  - ç”¨äºå»é™¤ä¸€ä¸ªæ•°çš„å°æ•°éƒ¨åˆ†ï¼Œè¿”å›æ•´æ•°éƒ¨åˆ†ï¼Œç›´æ¥ä¿ç•™ç¬¦å·ä½
  - å¯¹äºéæ•°å€¼å‚æ•°ï¼ŒMath.trunc å†…éƒ¨ä¼šä½¿ç”¨ Number æ–¹æ³•å°†å…¶è½¬æ¢ä¸ºæ•°å€¼ç±»å‹

  ```js
  Math.trunc(4.1) // 4
  Math.trunc(4.8) // 4
  Math.trunc(-4.1) // -4
  Math.trunc(-4.8) // -4
  Math.trunc(-0.123)// -0 å…¶å®-0å’Œ0æ˜¯ä¸¥æ ¼ç›¸ç­‰çš„ å³ -0 === 0 
  
  Math.trunc('asd')// NaN
  Math.trunc('1.1')// 1
  Math.trunc()// NaN
  ```

- Math.sign

  - ç”¨äºåˆ¤æ–­ä¸€ä¸ªæ•°åˆ°åº•æ˜¯æ­£æ•°ã€è´Ÿæ•°è¿˜æ˜¯0
    - å‚æ•°ä¸ºæ­£æ•°ï¼šè¿”å› 1
    - å‚æ•°ä¸ºè´Ÿæ•°ï¼šè¿”å› -1
    - å‚æ•°ä¸º 0ï¼š è¿”å› 0
    - å‚æ•°ä¸º -0ï¼šè¿”å› -0
    - å‚æ•°ä¸ºå…¶ä»–å€¼ï¼šè¿”å› NaN

- Math.cbrt

  - ç”¨äºè®¡ç®—ä¸€ä¸ªæ•°çš„ç«‹æ–¹æ ¹ï¼ˆx^(-3)ï¼‰

- Math.clz32

  - JSçš„æ•´æ•°ä½¿ç”¨32ä½äºŒè¿›åˆ¶å½¢å¼è¡¨ç¤ºï¼Œè¿”å›å€¼æ˜¯32ä½æ— ç¬¦å·æ•´æ•°å½¢å¼æœ‰å¤šå°‘ä¸ªå‰å¯¼0
  - å‚æ•°ä¸ºå°æ•°ï¼Œåªå–å…¶æ•´æ•°éƒ¨åˆ†åˆ¤æ–­
  - å‚æ•°ä¸ºè´Ÿæ•°ï¼Œè¿”å›å€¼ä¸º 0
  - å‚æ•°ä¸º trueï¼Œè¿”å›å€¼ä¸º 31ï¼Œå› ä¸º true æ•°å€¼ç±»å‹æ˜¯ç­‰äº 1ï¼Œfalse ç­‰äº0
  - å‚æ•°ä¸ºå…¶ä»–å€¼ï¼Œè¿”å›å€¼å…¨éƒ¨ä¸º 32

  ```js
  Math.clz(2) // 30 æœ‰30ä¸ªé›¶åœ¨1å‰é¢ 000...0010
  Math.clz32(2.123456)// 30
  ```

- Math.imul

  - è¿”å›ä¸¤ä¸ªæ•°ä»¥32ä½å¸¦ç¬¦å·æ•´æ•°å½¢å¼ç›¸ä¹˜çš„ç»“æœï¼Œè¿”å›å€¼ä¹Ÿæ˜¯32ä½å¸¦ç¬¦å·æ•´æ•°ï¼Œç³»ç»Ÿé»˜è®¤è½¬å›10è¿›åˆ¶æ•°

- Math.fround

  - è¿”å›ä¸€ä¸ªæ•°çš„å•ç²¾åº¦æµ®ç‚¹æ•°å½¢å¼

- Math.hypot

  - è¿”å›æ‰€æœ‰å‚æ•°çš„å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ï¼ˆç”¨äºç›¸é‡çš„æ¨¡ï¼Œå‘é‡çš„æ¨¡ï¼Œä¸¤ç‚¹é—´è·ç¦»å…¬å¼ç­‰ï¼‰

- æ–°å¢è®¡ç®—æ–¹æ³•

  - Math.expm1
    - è¿”å› (e^x) - 1
  - Math.log1p
    - è¿”å› ln(1+x)
  - Math.log10
    - è¿”å› ä»¥10 ä¸ºåº•çš„å¯¹æ•° lgx
  - Math.log2
    - è¿”å› ä»¥2 ä¸ºåº•çš„å¯¹æ•° lbx

### æ•°ç»„çš„æ‰©å±•

- Array.from

  - å°†ä¸¤ç±»å¯¹è±¡è½¬åŒ–ä¸ºæ•°ç»„
    - ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ˆä¼ªæ•°ç»„ï¼‰
    - å¯éå†çš„å¯¹è±¡ï¼ˆIterator ï¼‰
  - å¯éå†çš„å¯¹è±¡
  
  ```js
  let obj1 = {
      0: 'hello',
      1: 'world',
      length: 2
  }
  // æ ¹æ® length æ¥è®¾ç½®æ•°ç»„é•¿åº¦ï¼Œå°‘åˆ™èˆï¼Œå¤šåˆ™ undefined
Array.from(obj1) // ["hello", "world"]
  
  // å¯éå†
  Array.from('string')// ["s", "t", "r", "i", "n", "g"]
  // Array.from æ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œå’Œ map æ–¹æ³•ç±»ä¼¼ï¼Œéå†æ•°ç»„å…ƒç´ è¿”å›ä¸€ä¸ªæ–°æ•°ç»„
  Array.from([1, 2, 3, 4], x => x*x)// [1, 4, 9, 16]
  // å¯ç”¨äºå‚æ•°éšæœºæ•°æ•°ç»„
  Array.from({length: 5}, () => Math.random())
  ```
  
- Array.of

  - ç”¨äºå°†ä¸€ç»„å€¼è½¬æ¢ä¸ºæ•°ç»„
  - Array.of å‡ºç°çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å¼¥è¡¥ Array() çš„ä¸è¶³

  ```js
  Array.of(1, 2, 3, 4, 5)// [1, 2, 3, 4, 5]
  Array.of(1)// [1]
  Array.of(10).length// 1
  // åŒºåˆ«äº Array() æ„é€ å‡½æ•°
  Array(1, 2)// [1, 2]
  Array() // []
  Array(10)// [] é•¿åº¦ä¸º10ï¼Œæ¯ä¸ªå…ƒç´ éƒ½ä¸ºç©ºçš„æ•°ç»„
  Array(10).length// 10
  ```

- æ•°ç»„å®ä¾‹çš„ copyWithin

  - ç”¨äºåœ¨å½“å‰æ•°ç»„å†…éƒ¨ï¼Œå°†æŒ‡å®šä½ç½®çš„æˆå‘˜å¤åˆ¶åˆ°å…¶ä»–ä½ç½®ï¼ˆä¼šè¦†ç›–åŸæœ‰æˆå‘˜ï¼‰ï¼Œç„¶åè¿”å›å½“å‰æ•°ç»„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¼šä¿®æ”¹å½“å‰æ•°ç»„ã€‚
  - å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ã€‚
    - targetï¼ˆå¿…éœ€ï¼‰ï¼šä»è¯¥ä½ç½®å¼€å§‹æ›¿æ¢æ•°æ®ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºå€’æ•°ã€‚
    - startï¼ˆå¯é€‰ï¼‰ï¼šä»è¯¥ä½ç½®å¼€å§‹è¯»å–æ•°æ®ï¼Œé»˜è®¤ä¸º 0ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºä»æœ«å°¾å¼€å§‹è®¡ç®—ã€‚
    - endï¼ˆå¯é€‰ï¼‰ï¼šåˆ°è¯¥ä½ç½®å‰åœæ­¢è¯»å–æ•°æ®ï¼Œé»˜è®¤ç­‰äºæ•°ç»„é•¿åº¦ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºä»æœ«å°¾å¼€å§‹è®¡ç®—

  ```js
  [1, 2, 3, 4, 5, 6].copyWithin(0, 3)// [4, 5, 6, 4, 5, 6]
  ```

- æ•°ç»„å®ä¾‹çš„ find å’Œ findIndex æ–¹æ³•

  - ç”¨æ¥æ‰«ææ•°ç»„ï¼ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æ•°ç»„å…ƒç´ 
  - find è¿”å›æ•°ç»„å…ƒç´ æœ¬èº«
  - findIndex è¿”å›æ•°ç»„å…ƒç´ çš„ç´¢å¼•
  - ä¸¤ä¸ªå‚æ•°
    - å‡½æ•°ä½“
    - ç”¨æ¥ç»‘å®šå›è°ƒå‡½æ•°çš„this

  ```js
  // æ³¨æ„è¿™é‡Œ return çš„æ˜¯ä¸€ä¸ªåˆ¤æ–­çš„è¡¨è¾¾å¼ï¼Œä¸æ˜¯å…ƒç´ 
  // find() ä¼ å…¥çš„å‡½æ•°ä½“å¯ä»¥å¸¦ä¸‰ä¸ªå‚æ•°ï¼Œï¼ˆå…ƒç´ æœ¬èº«ï¼Œç´¢å¼•ï¼Œæ•°ç»„æœ¬èº«ï¼‰
  [3, 5, 1, 10, 6].find(value => value > 3)// 5
  [3, 5, 1, 10, 6].find(value => value > 111)// undefined
  [3, 5, 1, 10, 6].find(function (value, index, arr) {
      return value > 5
  })// 10
  
  [3, 5, 1, 10, 6].findIndex (value => value > 3)// 1
  ;[3, 5, 1, 10, 6].findIndex (value => value > 111)// -1
  
  // findIndex å’Œ indexOf çš„åŒºåˆ«ï¼ŒfindIndex å¯ä»¥æŸ¥è¯¢åˆ° NaN
  [NaN].indexOf(NaN) // -1 æŸ¥è¯¢ä¸åˆ°
  [NaN].findIndex(n => Object.is(NaN, n)) // 0
  ```

  - Object.is() åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸åŒã€‚å¦‚æœä¸‹åˆ—ä»»ä½•ä¸€é¡¹æˆç«‹ï¼Œåˆ™ä¸¤ä¸ªå€¼ç›¸åŒï¼š

    - ä¸¤ä¸ªå€¼éƒ½æ˜¯ undefined
    - ä¸¤ä¸ªå€¼éƒ½æ˜¯ null
    - ä¸¤ä¸ªå€¼éƒ½æ˜¯ true æˆ–è€…éƒ½æ˜¯ false
    - ä¸¤ä¸ªå€¼æ˜¯ç”±ç›¸åŒä¸ªæ•°çš„å­—ç¬¦æŒ‰ç…§ç›¸åŒçš„é¡ºåºç»„æˆçš„å­—ç¬¦ä¸²
    - ä¸¤ä¸ªå€¼æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡
    - ä¸¤ä¸ªå€¼éƒ½æ˜¯æ•°å­—å¹¶ä¸”
      - éƒ½æ˜¯æ­£é›¶ +0
      - éƒ½æ˜¯è´Ÿé›¶ -0
      - éƒ½æ˜¯ NaN
      - éƒ½æ˜¯é™¤é›¶å’Œ NaNå¤–çš„å…¶å®ƒåŒä¸€ä¸ªæ•°å­—

    è¿™ç§ç›¸ç­‰æ€§åˆ¤æ–­é€»è¾‘å’Œä¼ ç»Ÿçš„ == è¿ç®—ä¸åŒï¼Œ== è¿ç®—ç¬¦ä¼šå¯¹å®ƒä¸¤è¾¹çš„æ“ä½œæ•°åšéšå¼ç±»å‹è½¬æ¢ï¼ˆå¦‚æœå®ƒä»¬ç±»å‹ä¸åŒï¼‰ï¼Œç„¶åæ‰è¿›è¡Œç›¸ç­‰æ€§æ¯”è¾ƒï¼Œï¼ˆæ‰€ä»¥æ‰ä¼šæœ‰ç±»ä¼¼ 0 == false ç­‰äº true çš„ç°è±¡ï¼‰ï¼Œä½† Object.is ä¸ä¼šåšè¿™ç§ç±»å‹è½¬æ¢ã€‚

    è¿™ä¸ === è¿ç®—ç¬¦çš„åˆ¤å®šæ–¹å¼ä¹Ÿä¸ä¸€æ ·ã€‚=== è¿ç®—ç¬¦ï¼ˆå’Œ == è¿ç®—ç¬¦ï¼‰å°†æ•°å­—å€¼ -0 å’Œ +0 è§†ä¸ºç›¸ç­‰ï¼Œå¹¶è®¤Number.NaN ä¸º NaN ä¸ç­‰äº ã€‚

- æ•°ç»„å®ä¾‹çš„ fill æ–¹æ³•

  - ä½¿ç”¨ç»™å®šå€¼ï¼Œå¡«å……ä¸€ä¸ªæ•°ç»„ï¼Œä¸»è¦ç”¨äºçº¯å±å®è¯æ•°ç»„
  - å¦‚æœæ•°ç»„åŸæœ¬å°±æœ‰å€¼ï¼Œå°±ä¼šå°†å…¶è¦†ç›–
  - ä¸‰ä¸ªå‚æ•°
    - å¡«å……å†…å®¹ï¼ˆå¿…é¡»ï¼‰
    - å¡«å……èµ·å§‹ä½ç½®ï¼Œé»˜è®¤ä¸º0
    - å¡«å……ç»“æŸä¸ºæ­¢ï¼Œé»˜è®¤ä¸ºæ•°ç»„é•¿åº¦

  ```js
  new Array(10).fill(6)// [6, 6, 6, 6, 6, 6, 6, 6, 6, 6]
  [1,2,3].fill(6)// [6, 6, 6]
  [1,2,3].fill(6,1,2)// [1,6,3]
  ```

- æ•°ç»„å®ä¾‹çš„ entries ã€ keys å’Œ values æ–¹æ³•

  - ES6 æä¾›ä¸‰ä¸ªæ–°çš„æ–¹æ³•â€”â€”`entries()`ï¼Œ`keys()`å’Œ`values()`â€”â€”ç”¨äºéå†æ•°ç»„ã€‚å®ƒä»¬éƒ½è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼ˆIterator è¯¦è§åæ–‡ Iterator ä¸€èŠ‚ï¼‰ï¼Œå¯ä»¥ç”¨`for...of`å¾ªç¯è¿›è¡Œéå†ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯`keys()`æ˜¯å¯¹é”®åçš„éå†ã€`values()`æ˜¯å¯¹é”®å€¼çš„éå†ï¼Œ`entries()`æ˜¯å¯¹é”®å€¼å¯¹çš„éå†ã€‚

    ```javascript
    for (let index of ['a', 'b'].keys()) {
      console.log(index);
    }
    // 0
    // 1
    
    for (let elem of ['a', 'b'].values()) {
      console.log(elem);
    }
    // 'a'
    // 'b'
    
    for (let [index, elem] of ['a', 'b'].entries()) {
      console.log(index, elem);
    }
    // 0 "a"
    // 1 "b"
    ```

    å¦‚æœä¸ä½¿ç”¨`for...of`å¾ªç¯ï¼Œå¯ä»¥æ‰‹åŠ¨è°ƒç”¨éå†å™¨å¯¹è±¡çš„`next`æ–¹æ³•ï¼Œè¿›è¡Œéå†ã€‚

    ```javascript
    let letter = ['a', 'b', 'c'];
    let entries = letter.entries();
    console.log(entries.next().value); // [0, 'a']
    console.log(entries.next().value); // [1, 'b']
    console.log(entries.next().value); // [2, 'c']
    ```

- æ•°ç»„çš„ç©ºä½ï¼ˆArray(n) å°±æ˜¯ n ä¸ªç©ºä½çš„æ•°ç»„ï¼‰

  - æ•°ç»„çš„ç©ºä½æŒ‡ï¼Œæ•°ç»„çš„æŸä¸€ä¸ªä½ç½®æ²¡æœ‰ä»»ä½•å€¼ã€‚æ¯”å¦‚ï¼Œ`Array`æ„é€ å‡½æ•°è¿”å›çš„æ•°ç»„éƒ½æ˜¯ç©ºä½ã€‚

  - `Array(3)`è¿”å›ä¸€ä¸ªå…·æœ‰ 3 ä¸ªç©ºä½çš„æ•°ç»„ã€‚

    æ³¨æ„ï¼Œç©ºä½ä¸æ˜¯`undefined`ï¼Œä¸€ä¸ªä½ç½®çš„å€¼ç­‰äº`undefined`ï¼Œä¾ç„¶æ˜¯æœ‰å€¼çš„ã€‚ç©ºä½æ˜¯æ²¡æœ‰ä»»ä½•å€¼ï¼Œ`in`è¿ç®—ç¬¦å¯ä»¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚

    ```javascript
    0 in [undefined, undefined, undefined] // true
    0 in [, , ,] // false
    ```

    ä¸Šé¢ä»£ç è¯´æ˜ï¼Œç¬¬ä¸€ä¸ªæ•°ç»„çš„ 0 å·ä½ç½®æ˜¯æœ‰å€¼çš„ï¼Œç¬¬äºŒä¸ªæ•°ç»„çš„ 0 å·ä½ç½®æ²¡æœ‰å€¼ã€‚

    ES5 å¯¹ç©ºä½çš„å¤„ç†ï¼Œå·²ç»å¾ˆä¸ä¸€è‡´äº†ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¼šå¿½ç•¥ç©ºä½ã€‚

    - `forEach()`, `filter()`, `reduce()`, `every()` å’Œ`some()`éƒ½ä¼šè·³è¿‡ç©ºä½ã€‚
    - `map()`ä¼šè·³è¿‡ç©ºä½ï¼Œä½†ä¼šä¿ç•™è¿™ä¸ªå€¼
    - `join()`å’Œ`toString()`ä¼šå°†ç©ºä½è§†ä¸º`undefined`ï¼Œè€Œ`undefined`å’Œ`null`ä¼šè¢«å¤„ç†æˆç©ºå­—ç¬¦ä¸²ã€‚

    ```javascript
    // forEachæ–¹æ³•
    [,'a'].forEach((x,i) => console.log(i)); // 1
    
    // filteræ–¹æ³•
    ['a',,'b'].filter(x => true) // ['a','b']
    
    // everyæ–¹æ³•
    [,'a'].every(x => x==='a') // true
    
    // reduceæ–¹æ³•
    [1,,2].reduce((x,y) => x+y) // 3
    
    // someæ–¹æ³•
    [,'a'].some(x => x !== 'a') // false
    
    // mapæ–¹æ³•
    [,'a'].map(x => 1) // [,1]
    
    // joinæ–¹æ³•
    [,'a',undefined,null].join('#') // "#a##"
    
    // toStringæ–¹æ³•
    [,'a',undefined,null].toString() // ",a,,"
    ```

    ES6 åˆ™æ˜¯æ˜ç¡®å°†ç©ºä½è½¬ä¸º`undefined`ã€‚

    `Array.from`æ–¹æ³•ä¼šå°†æ•°ç»„çš„ç©ºä½ï¼Œè½¬ä¸º`undefined`ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•ä¸ä¼šå¿½ç•¥ç©ºä½ã€‚

    ```javascript
    Array.from(['a',,'b'])
    // [ "a", undefined, "b" ]
    ```

    æ‰©å±•è¿ç®—ç¬¦ï¼ˆ`...`ï¼‰ä¹Ÿä¼šå°†ç©ºä½è½¬ä¸º`undefined`ã€‚

    ```javascript
    [...['a',,'b']]
    // [ "a", undefined, "b" ]
    ```

    `copyWithin()`ä¼šè¿ç©ºä½ä¸€èµ·æ‹·è´ã€‚

    ```javascript
    [,'a','b',,].copyWithin(2,0) // [,"a",,"a"]
    ```

    `fill()`ä¼šå°†ç©ºä½è§†ä¸ºæ­£å¸¸çš„æ•°ç»„ä½ç½®ã€‚

    ```javascript
    new Array(3).fill('a') // ["a","a","a"]
    ```

    `for...of`å¾ªç¯ä¹Ÿä¼šéå†ç©ºä½ã€‚

    ```javascript
    let arr = [, ,];
    for (let i of arr) {
      console.log(1);
    }
    // 1
    // 1
    ```

    ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„`arr`æœ‰ä¸¤ä¸ªç©ºä½ï¼Œ`for...of`å¹¶æ²¡æœ‰å¿½ç•¥å®ƒä»¬ã€‚å¦‚æœæ”¹æˆ`map`æ–¹æ³•éå†ï¼Œç©ºä½æ˜¯ä¼šè·³è¿‡çš„ã€‚

    `entries()`ã€`keys()`ã€`values()`ã€`find()`å’Œ`findIndex()`ä¼šå°†ç©ºä½å¤„ç†æˆ`undefined`ã€‚

    ```javascript
    // entries()
    [...[,'a'].entries()] // [[0,undefined], [1,"a"]]
    
    // keys()
    [...[,'a'].keys()] // [0,1]
    
    // values()
    [...[,'a'].values()] // [undefined,"a"]
    
    // find()
    [,'a'].find(x => true) // undefined
    
    // findIndex()
    [,'a'].findIndex(x => true) // 0
    ```

    ç”±äºç©ºä½çš„å¤„ç†è§„åˆ™éå¸¸ä¸ç»Ÿä¸€ï¼Œæ‰€ä»¥å»ºè®®é¿å…å‡ºç°ç©ºä½ã€‚

### å‡½æ•°çš„æ‰©å±•

- å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼

  ```js
  var write = function (x = 'Hello', y = 'world!') {
      console.log(x, y)
  }
  write()
  ```

- å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼å’Œè§£æ„èµ‹å€¼é»˜è®¤å€¼çš„ç»“åˆä½¿ç”¨

  ```js
  var fun = function ({x,y = 5}) {
      console.log(x, y)
  }
  fun()// error
  fun({})// undefined 5
  fun({x: 'hello'})// hello 5
  fun({x: 'hello',y: 'world'})// hello world
  
  var fun1 = function (n,{x,y = 5}) {
      console.log(n, x, y)
  }
  fun1(1)// error
  fun1(1,{})// 1 undefined 5
  fun1(1,{x: 'hello'})// 1 hello 5
  fun1(1,{x: 'hello',y: 'world'})// 1 hello world
  
  var fun2 =  function (n,{x,y = 5} = {}) {
      console.log(n, x, y)
  }
  fun2(1)// 1 undefined 5
  fun2(1,{})// 1 undefined 5
  fun2(1,{x: 'hello'})// 1 hello 5
  fun2(1,{x: 'hello',y: 'world'})// 1 hello world
  
  // ä¸‹é¢ä¸¤ç§ä¾‹å­çš„åŒºåˆ«
  var f1 = function ({x=0,y=0} = {}) {
      console.log(x,y)
  }
  var f2 = function ({x,y} = {x:0,y:0}) {
      console.log(x,y)
  }
  f1({x:1})// 1 0 å› ä¸ºè§£æ„èµ‹å€¼åŸæœ¬å°±æœ‰äº†é»˜è®¤å€¼ï¼Œæ‰€ä»¥è¿™æ ·è¦†ç›–è§£æ„yä¹Ÿæœ‰å€¼
  f2({x:1})// 1 undefined è¿™æ ·èµ‹å€¼ç›¸å½“äºè¦†ç›–äº†ç»™å¯¹è±¡çš„è§£æ„èµ‹å€¼ï¼Œæ‰€ä»¥yæœªå®šä¹‰
  ```

- è·å–å‡½æ•°æ— é»˜è®¤å€¼å‚æ•°çš„ä¸ªæ•°

  - å‡½æ•°çš„ length å±æ€§(å½¢å‚ä»å‰å¾€åæ£€æµ‹ï¼Œé‡åˆ°æœ‰é»˜è®¤å€¼çš„å°±ä¸æ£€æµ‹äº†ï¼Œä¸å‡†ç¡®ï¼Œæ‰€ä»¥å¹¶æ²¡ä»€ä¹ˆç”¨)

  ```js
  (function (x,y,z) {
      
  }).length // 3
  (function (x,y=1,z) {
      
  }).length // 1
  (function (x,y,z=1,n) {
      
  }).length // 2
  ```

- restå‚æ•°

  - è¯­æ³•ï¼šâ€¦å˜é‡å
  - ä¸€å®šè¦æ”¾åœ¨æ•°ç»„è§£æ„æˆ–è€…å‡½æ•°å½¢å‚çš„æœ€åé¢
  - arguments å’Œ restå‚æ•° çš„åŒºåˆ«
    - argumentsæ˜¯å¯¹è±¡ï¼Œå®šä¹‰å‡½æ•°æ—¶ä¸éœ€è¦æ”¾å…¥å½¢å‚ï¼Œè·å–æ‰€æœ‰å‚æ•°çš„å€¼
    - restå‚æ•°æ˜¯æ•°ç»„ï¼Œå®šä¹‰å‡½æ•°æ—¶è¦æ”¾å…¥å½¢å‚å¹¶å‘½åï¼Œè·å–çš„æ˜¯ï¼Œé™¤äº†å‰é¢å…¶ä»–å½¢å‚çš„å‰©ä½™å€¼ï¼Œå¹¶ä¸” rest å‚æ•°ä¹Ÿå¯ä»¥ç”¨äºæ•°ç»„è§£æ„ï¼Œä¸ä¸€å®šè¦åœ¨å‡½æ•°ä¸­ä½¿ç”¨

  ```js
  var add = function (...value) {
      var sum = 0
      value.map(n => sum += n)
      return sum
  }
  add(1,2,3,4)// 10
  var sub = function (a,b,...value) {
      var sum = 0
      sum = value[0]-value[1]
      return sum
  }
  sub(1,2,3,4)//-1
  sub(1,2,3)//NaN 3-undefinedæ˜¯NaN
  ```

- æ‰©å±•è¿ç®—ç¬¦ `...`

  - é€šä¿—ç†è§£ï¼ŒæŠŠæ•°ç»„çš„æ‹¬å·å»æ‰ï¼Œå³ä¸€ä¸ªå‚æ•°ï¼Œå˜æˆäº†å¤šä¸ªå‚æ•°
  - ç”¨é€”
    - åˆå¹¶æ•°ç»„
    - ç²¾ç¡®è·å– UTF-16 çš„å­—ç¬¦ä¸²é•¿åº¦

  ```js
  var values = ["hello","world","!"]
  console.log(...value)// ç›¸å½“äº console.log("hello","world","!")
  // hello world !
  
  //åˆå¹¶æ•°ç»„
  var arr1 = [1,2]
  var arr2 = [3,4]
  var arr3 = [5,6]
  var arr4 = arr1.concat(arr2,arr3)// [1,2,3,4,5,6]
  var arr5 = [...arr1,...arr2,...arr3]// [1,2,3,4,5,6]
  
  //ç²¾ç¡®è·å–å­—ç¬¦ä¸²é•¿åº¦
  "ağŸ’a".length// 4 "a\ud83d\udc12a"
  [..."ağŸ’a"].length// 3
  "ağŸ’b".split('').reverse().join('')// "bï¿½ï¿½a" "b\udc12\ud83da"
  [..."ağŸ’b"].reverse().join('')// "bğŸ’a" "b\ud83d\udc12a"
  ```

- å‡½æ•°çš„ name å±æ€§

  ```js
  var fun = function () {}
  fun.name// ES6 fun ES5æ˜¯ç©ºä¸²
  
  function fun1() {}
  fun1.name// fun1
  
  // ä¸‹é¢çš„å‡½æ•°å®šä¹‰æ–¹æ³•æ˜¯ Airbnbä»£ç è§„èŒƒ ä¸­æ¨èä½¿ç”¨çš„
  var f1 = function f2() {
      
  }
  f1.name// f2
  
  (new Function).name// anonymous(åŒ¿å)
  
  function test() {}
  test.bind(f1).name // bound test
  ```

- ç®­å¤´å‡½æ•° (vueé‚£ç¯‡ç¬”è®°ä¸­æœ‰è¯¦ç»†è¯´æ˜)

  - ä½¿ç”¨ `=>` å®šä¹‰çš„å‡½æ•°
  - ç®­å¤´çš„å·¦ä¾§ä¸ºå‡½æ•°çš„å‚æ•°ï¼Œå³ä¾§è¡¨ç¤ºå‡½æ•°ä½“
  - å¦‚æœå³ä¾§åªæœ‰ä¸€æ¡è¯­å¥ï¼Œåˆ™ä½œä¸ºè¿”å›å€¼
  - ç®­å¤´å‡½æ•°çš„ this çš„æŒ‡å‘å…³ç³»æ˜¯é‡ç‚¹ï¼Œåœ¨vueé‚£ç¯‡ç¬”è®°ä¸­ä¹Ÿæœ‰è¯¦ç»†çš„è®²è¿°

### å¯¹è±¡çš„æ‰©å±•

- å±æ€§çš„ç®€ä»‹è¡¨ç¤ºæ³•

  - å¦‚æœå±æ€§åå’Œå±æ€§å€¼ä½ç½®çš„å˜é‡åç›¸åŒï¼Œåˆ™å¯ä»¥åªç”¨ä¸€ä¸ªå˜é‡åï¼Œå³è¡¨ç¤ºå±æ€§ååˆè¡¨ç¤ºå±æ€§å€¼
  - å¦‚æœæ­¤å±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå±æ€§å€¼æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œåˆ™å¯ä»¥ç›´æ¥å®šä¹‰å‡½æ•°ï¼Œå³è¡¨ç¤ºå±æ€§ååˆè¡¨ç¤ºå±æ€§å€¼

  ```js
  // ES5
  var name = 'Bill'
  var obj = {name: name}
  // ES6
  var obj1 = {name}
  
  // ES5
  var obj2 = {
      fun: function () {
          return "hello world"
      }
  }
  // ES6
  var obj3 = {
      fun() {
          return "hello world"
      }
  }
  ```

- å±æ€§åè¡¨è¾¾å¼

  - ä¸€ç§æ–°å¢çš„ï¼ŒåŠ¨æ€ç»™å¯¹è±¡æ·»åŠ å±æ€§çš„æ–¹æ³•

  ```js
  var obj = {}
  // ES5
  obj.age = 30
  obj['salary'] = 3000
  // ES6 å±æ€§åè¡¨è¾¾å¼
  var p = 'x'
  obj['na'+'me'] = 'Mary'
  obj[p+p] = 'pp'
  // {age: 30, salary: 3000, name: "Mary", xx: "pp"}
  var obj2 = {
      ['product' + 1 * 666]: 'ioooooooooo',
      [p]: 'p'
  }
  // {product666: "ioooooooooo", x: "p"}
  var obj1 = {
      ['f'+'un']() {
          console.log('fun')
      }
  }
  obj1.fun() // fun
  ```

- Object.is

  - åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸åŒã€‚å¦‚æœä¸‹åˆ—ä»»ä½•ä¸€é¡¹æˆç«‹ï¼Œåˆ™ä¸¤ä¸ªå€¼ç›¸åŒï¼š

    - ä¸¤ä¸ªå€¼éƒ½æ˜¯ undefined
    - ä¸¤ä¸ªå€¼éƒ½æ˜¯ null
    - ä¸¤ä¸ªå€¼éƒ½æ˜¯ true æˆ–è€…éƒ½æ˜¯ false
    - ä¸¤ä¸ªå€¼æ˜¯ç”±ç›¸åŒä¸ªæ•°çš„å­—ç¬¦æŒ‰ç…§ç›¸åŒçš„é¡ºåºç»„æˆçš„å­—ç¬¦ä¸²
    - ä¸¤ä¸ªå€¼æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡
    - ä¸¤ä¸ªå€¼éƒ½æ˜¯æ•°å­—å¹¶ä¸”
      - éƒ½æ˜¯æ­£é›¶ +0
      - éƒ½æ˜¯è´Ÿé›¶ -0
      - éƒ½æ˜¯ NaN
      - éƒ½æ˜¯é™¤é›¶å’Œ NaNå¤–çš„å…¶å®ƒåŒä¸€ä¸ªæ•°å­—

    è¿™ç§ç›¸ç­‰æ€§åˆ¤æ–­é€»è¾‘å’Œä¼ ç»Ÿçš„ == è¿ç®—ä¸åŒï¼Œ== è¿ç®—ç¬¦ä¼šå¯¹å®ƒä¸¤è¾¹çš„æ“ä½œæ•°åšéšå¼ç±»å‹è½¬æ¢ï¼ˆå¦‚æœå®ƒä»¬ç±»å‹ä¸åŒï¼‰ï¼Œç„¶åæ‰è¿›è¡Œç›¸ç­‰æ€§æ¯”è¾ƒï¼Œï¼ˆæ‰€ä»¥æ‰ä¼šæœ‰ç±»ä¼¼ 0 == false ç­‰äº true çš„ç°è±¡ï¼‰ï¼Œä½† Object.is ä¸ä¼šåšè¿™ç§ç±»å‹è½¬æ¢ã€‚

    è¿™ä¸ === è¿ç®—ç¬¦çš„åˆ¤å®šæ–¹å¼ä¹Ÿä¸ä¸€æ ·ã€‚=== è¿ç®—ç¬¦ï¼ˆå’Œ == è¿ç®—ç¬¦ï¼‰å°†æ•°å­—å€¼ -0 å’Œ +0 è§†ä¸ºç›¸ç­‰ï¼Œå¹¶è®¤Number.NaN ä¸º NaN ä¸ç­‰äº ã€‚

- Object.assign

  - ç”¨äºå¤åˆ¶å¯¹è±¡å±æ€§ï¼ˆåŒ…æ‹¬å±æ€§å€¼ï¼‰ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡æˆ–è€…å„æºå¯¹è±¡å«æœ‰åŒåå±æ€§ï¼Œåˆ™åé¢å¤åˆ¶çš„å±æ€§ä¼šè¦†ç›–å‰é¢çš„å±æ€§
  - assign åªå¤åˆ¶èµ„æ·±çš„å±æ€§ï¼Œä¸å¯æšä¸¾çš„å±æ€§å’Œç»§æ‰¿çš„å±æ€§ä¸ä¼šå¤åˆ¶
  - ä¸¤ä¸ªå‚æ•°
    - targetObj
    - â€¦restå‚æ•°ï¼ˆsourceObjï¼‰

  ```js
  var target = {id: 10}
  var source1 = {name: 'iooo'}
  var source2 = {price: 7000}
  var source3 = {location: 'CN'}
  Object.assign(target, source1, source2, source3)
  console.log(target)// {id: 10, name: "iooo", price: 7000, location: "CN"}
  
  var target = {id: 10}
  var source1 = {name: 'iooo',id: 11}
  var source2 = {price: 7000,name: 'iooq',id:12}
  var source3 = {location: 'CN'}
  Object.assign(target, source1, source2, source3)
  console.log(target)// {id: 12, name: "iooq", price: 7000, location: "CN"}
  
  // ä¸ºå¯¹è±¡æ·»åŠ å±æ€§
  class MyClass {
      constructor(x,y) {
          Object.assign(this, {x, y})
      }
  }
  var my = new MyClass(10, 20)
  console.log(my)// MyClassÂ {x: 10, y: 20}
  
  //å…‹éš†å¯¹è±¡
  function cloneObj(origin) {
      return Object.assign({}, origin)
  }
  var origin = {id: 20,name: 'Bill'}
  var clone = cloneObj(origin)// {id: 20, name: "Bill"}
  ```

### Symbol

ES5 çš„å¯¹è±¡å±æ€§åéƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™å®¹æ˜“é€ æˆå±æ€§åçš„å†²çªã€‚æ¯”å¦‚ï¼Œä½ ä½¿ç”¨äº†ä¸€ä¸ªä»–äººæä¾›çš„å¯¹è±¡ï¼Œä½†åˆæƒ³ä¸ºè¿™ä¸ªå¯¹è±¡æ·»åŠ æ–°çš„æ–¹æ³•ï¼ˆmixin æ¨¡å¼ï¼‰ï¼Œæ–°æ–¹æ³•çš„åå­—å°±æœ‰å¯èƒ½ä¸ç°æœ‰æ–¹æ³•äº§ç”Ÿå†²çªã€‚å¦‚æœæœ‰ä¸€ç§æœºåˆ¶ï¼Œä¿è¯æ¯ä¸ªå±æ€§çš„åå­—éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„å°±å¥½äº†ï¼Œè¿™æ ·å°±ä»æ ¹æœ¬ä¸Šé˜²æ­¢å±æ€§åçš„å†²çªã€‚è¿™å°±æ˜¯ ES6 å¼•å…¥`Symbol`çš„åŸå› ã€‚

ES6 å¼•å…¥äº†ä¸€ç§æ–°çš„åŸå§‹æ•°æ®ç±»å‹ `Symbol`ï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼ã€‚å®ƒæ˜¯ JavaScript è¯­è¨€çš„ç¬¬ä¸ƒç§æ•°æ®ç±»å‹ï¼Œå‰å…­ç§æ˜¯ï¼š`undefined`ã€`null`ã€å¸ƒå°”å€¼ï¼ˆBooleanï¼‰ã€å­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€æ•°å€¼ï¼ˆNumberï¼‰ã€å¯¹è±¡ï¼ˆObjectï¼‰ã€‚

Symbol å€¼é€šè¿‡`Symbol`å‡½æ•°ç”Ÿæˆã€‚è¿™å°±æ˜¯è¯´ï¼Œå¯¹è±¡çš„å±æ€§åç°åœ¨å¯ä»¥æœ‰ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯åŸæ¥å°±æœ‰çš„å­—ç¬¦ä¸²ï¼Œå¦ä¸€ç§å°±æ˜¯æ–°å¢çš„ Symbol ç±»å‹ã€‚å‡¡æ˜¯å±æ€§åå±äº Symbol ç±»å‹ï¼Œå°±éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œå¯ä»¥ä¿è¯ä¸ä¼šä¸å…¶ä»–å±æ€§åäº§ç”Ÿå†²çªã€‚

- Symbol ä¸èƒ½ä¸å…¶ä»–ç±»å‹çš„å€¼è¿›è¡Œè¿ç®—ï¼Œå¦åˆ™ä¼šæŠ¥é”™

  ```js
  var sym = Symbol('Test Symbol')
  
  // Symbol å¯ä»¥æ˜¾å¼è½¬æ¢ä¸º Stringï¼Œä½†ä¸èƒ½éšå¼è½¬æ¢ä¸º String
  var sss = 'hello' + sym //error è¿ç®—æ˜¯éšå¼è½¬æ¢
  var str = String(sym)// "Symbol(Test Symbol)"
  var str1 = sym.toString()// "Symbol(Test Symbol)"
  
  // Symbol å¯ä»¥è½¬ä¸ºå¸ƒå°”å€¼ï¼Œä½†ä¸èƒ½è½¬ä¸ºæ•°å€¼
  Boolean(sym)// true
  Number(sym)// error
  ```

- Symbol ä½œä¸ºå±æ€§å

  - è°ƒç”¨ç”¨ Symbol å®šä¹‰çš„å¯¹è±¡çš„å±æ€§æ—¶ï¼Œä¸èƒ½ç”¨ . çš„æ–¹å¼è°ƒç”¨ï¼Œå› ä¸º . è°ƒç”¨çš„æ˜¯ å­—ç¬¦ä¸²å±æ€§å
  - å…³äºå…¨å±€çŠ¶æ€ä¸‹ç”¨ `var name = Symbol` ä¼šæŠ¥é”™çš„é—®é¢˜
    - name æ˜¯ window çš„ç‰¹æœ‰å±æ€§ï¼Œåœ¨å…¨å±€ç¯å¢ƒä¸‹å®šä¹‰çš„nameå˜é‡ï¼Œèµ‹ä»»ä½•å€¼éƒ½ä¼šè‡ªåŠ¨è½¬åŒ–æˆå­—ç¬¦ä¸²ï¼Œè€ŒSymbolç±»å‹ä¸èƒ½ç›´æ¥è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æŠ¥é”™äº†ã€‚

  ```js
  var s = Symbol('a')
  var ss = Symbol('a')
  var obj = {}
  // æ–¹æ³•ä¸€
  obj[s] = 'Bill'
  obj[ss] = 'Mary'
  
  // æ–¹æ³•äºŒ
  var obj2 = {
      [s]: 'John'
  }
  
  // æ–¹æ³•ä¸‰
  var obj3 = {}
  Object.defineProperty(obj3,s,{value: 'John'})
  
  // è°ƒç”¨
  console.log(obj[s])
  ```

- Symbol å±æ€§åçš„éå†

  ```js
  var obj = {name: 'Bill'}
  var a = Symbol('a')
  var b = Symbol('b')
  obj[a] = 'Hello'
  obj[b] = 'World'
  // Object.getOwnPropertySymbols æ–¹æ³•åªéå† Symbol å±æ€§
  var objectSymbols = Object.getOwnPropertySymbols(obj)
  console.log(objectSymbols)// [Symbol(a), Symbol(b)]
  
  // for...in, Object.keys(), Object.getOwnPropertyNames åªèƒ½éå†å­—ç¬¦ä¸²å±æ€§
  for (var key in obj) {
      console.log(key)
  }
  // name
  
  // åŒæ—¶è·å– Symbol å’Œé Symbol å±æ€§
  console.log(Reflect.ownKeys(obj))// ["name", Symbol(a), Symbol(b)]
  
  // å¯ä»¥åˆ©ç”¨ Symbol çš„ç‰¹æ€§ä¸ºå¯¹è±¡æ·»åŠ ä¸€äº›éç§æœ‰ï¼Œä½†æ˜¯åˆå¸Œæœ›åªç”¨äºå†…éƒ¨çš„æ–¹æ³•
  var size = Symbol('size')
  class Collection {
      constructor() {
          this[size] = 0 // ä¸ºå¯¹è±¡æ·»åŠ ä¸€ä¸ª Symbol ç±»å‹ï¼Œåä¸º size çš„å±æ€§
      }
      add(item) {
          this[this[size]] = item
          this[size]++
      }
      static sizeOf(instance) {
          return instance[size]
      }
  }
  var cc = new Collection()
  console.log(Collection.sizeOf(cc))
  cc.add('ok')
  cc.add('not ok')
  console.log(Collection.sizeOf(cc))
  console.log(object.keys(cc))// ["0", "1"]
  console.log(Reflect.ownKeys(cc))// ["0", "1", Symbol(size)]
  ```

- Symbol.for & Symbol.keyFor

  - Symbole.for 
    - æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›é‡æ–°ä½¿ç”¨åŒä¸€ä¸ª Symbol å€¼ï¼Œ`Symbol.for`æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œç„¶åæœç´¢æœ‰æ²¡æœ‰ä»¥è¯¥å‚æ•°ä½œä¸ºåç§°çš„ Symbol å€¼ã€‚å¦‚æœæœ‰ï¼Œå°±è¿”å›è¿™ä¸ª Symbol å€¼ï¼Œå¦åˆ™å°±æ–°å»ºå¹¶è¿”å›ä¸€ä¸ªä»¥è¯¥å­—ç¬¦ä¸²ä¸ºåç§°çš„ Symbol å€¼ã€‚
    - `Symbol.for()`ä¸`Symbol()`è¿™ä¸¤ç§å†™æ³•ï¼Œéƒ½ä¼šç”Ÿæˆæ–°çš„ Symbolã€‚å®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼Œå‰è€…ä¼šè¢«ç™»è®°åœ¨å…¨å±€ç¯å¢ƒä¸­ä¾›æœç´¢ï¼Œåè€…ä¸ä¼šã€‚`Symbol.for()`ä¸ä¼šæ¯æ¬¡è°ƒç”¨å°±è¿”å›ä¸€ä¸ªæ–°çš„ Symbol ç±»å‹çš„å€¼ï¼Œè€Œæ˜¯ä¼šå…ˆæ£€æŸ¥ç»™å®šçš„`key`æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨æ‰ä¼šæ–°å»ºä¸€ä¸ªå€¼ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ è°ƒç”¨`Symbol.for("cat")`30 æ¬¡ï¼Œæ¯æ¬¡éƒ½ä¼šè¿”å›åŒä¸€ä¸ª Symbol å€¼ï¼Œä½†æ˜¯è°ƒç”¨`Symbol("cat")`30 æ¬¡ï¼Œä¼šè¿”å› 30 ä¸ªä¸åŒçš„ Symbol å€¼ã€‚
  - Symbol.keyFor
    - `Symbol.keyFor`æ–¹æ³•è¿”å›ä¸€ä¸ªå·²ç™»è®°çš„ Symbol ç±»å‹å€¼çš„`key`ã€‚

  ```js
  var name1 = Symbol('name')
  var name2 = Symbol('name')
  console.log(name1 === name2)// false
  var s = Symbol.for('x')
  var ss = Symbol.for('x')
  console.log(s === ss)// true
  
  console.log(Symbol.keyFor(s))// x
  console.log(Symbol.keyFor(name1))// undefined å› ä¸ºç›´æ¥ç”¨Symbol() æ–¹å¼ç”Ÿæˆçš„ Symbol å€¼ä¸ä¼šè¢«ç™»è®°
  ```


### Proxy

Proxy ç”¨äºä¿®æ”¹æŸäº›æ“ä½œçš„é»˜è®¤è¡Œä¸ºï¼Œç­‰åŒäºåœ¨è¯­è¨€å±‚é¢åšå‡ºä¿®æ”¹ï¼Œæ‰€ä»¥å±äºä¸€ç§â€œå…ƒç¼–ç¨‹â€ï¼ˆmeta programmingï¼‰ï¼Œå³å¯¹ç¼–ç¨‹è¯­è¨€è¿›è¡Œç¼–ç¨‹ã€‚

Proxy å¯ä»¥ç†è§£æˆï¼Œåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚â€œæ‹¦æˆªâ€ï¼Œå¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®ï¼Œéƒ½å¿…é¡»å…ˆé€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œå› æ­¤æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥å¯¹å¤–ç•Œçš„è®¿é—®è¿›è¡Œè¿‡æ»¤å’Œæ”¹å†™ã€‚Proxy è¿™ä¸ªè¯çš„åŸæ„æ˜¯ä»£ç†ï¼Œç”¨åœ¨è¿™é‡Œè¡¨ç¤ºç”±å®ƒæ¥â€œä»£ç†â€æŸäº›æ“ä½œï¼Œå¯ä»¥è¯‘ä¸ºâ€œä»£ç†å™¨â€ã€‚

- Proxy ç”¨äºæ‹¦æˆªå¯¹è±¡çš„æ“ä½œ

  - var obj = new Proxy(target, handler)
    target: è¦æ‹¦æˆªçš„å¯¹è±¡
    handler: æ‹¦æˆªçš„åŠ¨ä½œ

  ```js
  var obj1 = {
      name: 'Bill',
      fun() {
          console.log('Function Bill')
      }
  }
  
  var obj2 = {
      name: 'Mike',
      fun() {
          console.log('Function Mike')
      }
  }
  // è°ƒç”¨è®¿é—®å¯¹è±¡å‰ï¼Œç»Ÿä¸€è¿›è¡Œæ“ä½œï¼Œä¹Ÿå°±æ˜¯æ‹¦æˆª
  // åˆ›å»ºä»£ç†
  var obj = new Proxy(obj1, {
      get: function (target, key, receiver) {
          console.log('-------------------')
          return Reflect.get(target, key, receiver)
      }
  })
  console.log(obj.name)
  // -------------------
  // Bill
  obj.fun()
  // -------------------
  // Function Bill
  ```

- æ‹¦æˆªå±æ€§çš„è¯»å–æ“ä½œï¼šget

  ```js
  // é€šè¿‡ä»£ç†æˆ‘ä»¬å¯ä»¥è®©è¯»å–å¯¹è±¡ä¸å­˜åœ¨å±æ€§æ—¶æŠ›å‡ºå¼‚å¸¸
  var product = {
      name: 'ioo'
  }
  var proxy = new Proxy(product,{
      get: function (target, property) {
          // in æ“ä½œç¬¦: å¦‚æœæŒ‡å®šçš„å±æ€§åœ¨æŒ‡å®šçš„å¯¹è±¡æˆ–å…¶åŸå‹é“¾ä¸­ï¼Œåˆ™in è¿ç®—ç¬¦è¿”å›trueã€‚
          if (property in target) {
              return target[property]
          } else {
              throw new ReferenceError(`å±æ€§"${property}"ä¸å­˜åœ¨`)
          }
      }
  })
  console.log(proxy.name)
  console.log(proxy.price)
  
  // get ä»£ç†ç»§æ‰¿
  let proto = new Proxy({},{
      get(target, propertyKey, receiver) {
          console.log('GET ' + propertyKey)
          return target[propertyKey]
      }
  })
  // Object.create()æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿ç”¨ç°æœ‰çš„å¯¹è±¡æ¥æä¾›æ–°åˆ›å»ºçš„å¯¹è±¡çš„__proto__ã€‚
  let obj = Object.create(proto)
  console.log(obj.name)
  
  // åº”ç”¨ï¼Œåˆ©ç”¨ get ä»£ç†è¯»å–æ•°ç»„çš„è´Ÿç´¢å¼•
  var arr = [1,2,3]
  // arr[0] = arr[-3]; arr[1] = arr[-2]; arr[2] = arr[-1]
  function createSuperArray(...elements) {
      let handler = {
          get(target, key, receiver) {
              let index = Number(key)
              if (index < 0) {
                  key = String(target.length + index)
              }
              return Reflect.get(target, key, receiver)
          }
      }
      return new Proxy(elements, handler)
  }
  
  let arr1 = createSuperArray(1,2,3)
  //arr1[-1]
  //3
  //arr1[-4]
  //undefined
  //arr1[-2]
  //2
  //arr1[-3]
  //1
  ```

- æ‹¦æˆªå±æ€§å†™å…¥æ“ä½œçš„ï¼šset

  ```js
  // æ ¡éªŒå±æ€§å€¼
  var pro = {
      name: 'iooo',
      price: 80// 30-180
  }
  let validator = {
      set(obj, key, value) {
          if (key === 'price') {
              if (!Number.isInteger(value)) {
                  throw new TypeError('ä»·æ ¼å¿…é¡»æ˜¯æ•´æ•°')
              }
              if (value < 30 || value > 180) {
                  throw new RangeError('ä»·æ ¼å¿…é¡»åœ¨30åˆ°180ä¹‹é—´')
              }
          }
          obj[key] = value
      }
  }
  let product = new Proxy(pro, validator)
  product.price = 200
  
  // æ§åˆ¶å±æ€§æ˜¯å¦è¢«è®¿é—®
  // å¯¹è±¡çš„å†…éƒ¨å±æ€§ é€šå¸¸å±æ€§åä»¥ _ å¼€å¤´çš„ï¼Œéƒ½æ˜¯å†…éƒ¨ç§æœ‰å±æ€§
  var handler = {
      get(target, key) {
          invariant(key)
          return target[key]
      },
      set(target, key, value) {
          invariant(key)
          return 'ok'
      }
  }
  
  function invariant(key) {
      if (key[0] === '_') {
          throw new Error('ç§æœ‰å±æ€§ï¼Œä¸èƒ½è¢«è®¿é—®')
      }
  }
  
  var obj = {
      name:'Bill',
      _value: 20
  }
  var objProxy = new Proxy(obj, handler)
  console.log(objProxy.name) // Bill
  console.log(objProxy._value)// Error: ç§æœ‰å±æ€§ï¼Œä¸èƒ½è¢«è®¿é—®
  objProxy._value = 31// Error: ç§æœ‰å±æ€§ï¼Œä¸èƒ½è¢«è®¿é—®
  ```

- æ‹¦æˆªå‡½æ•°çš„è°ƒç”¨ã€call å’Œ applyï¼šapply

  - `apply`æ–¹æ³•æ‹¦æˆªå‡½æ•°çš„è°ƒç”¨ã€`call`å’Œ`apply`æ“ä½œã€‚

    `apply`æ–¹æ³•å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ç›®æ ‡å¯¹è±¡ã€ç›®æ ‡å¯¹è±¡çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆ`this`ï¼‰å’Œç›®æ ‡å¯¹è±¡çš„å‚æ•°æ•°ç»„ã€‚

  ```js
  var fun = function () {
      return 'hello world!'
  }
  var handler = {
      apply() {
          return 'ä½ å¥½' // æ”¹å˜è¿”å›å€¼
      }
  }
  var funProxy = new Proxy(fun, handler)
  funProxy() // ä½ å¥½
  
  function sum(n1, n2) {
      return n1 + n2
  }
  var twice = {
      apply(target, ctx, args) {
          //Reflect.apply(...arguments) ç›¸å½“äºç”¨Reflect.applyæ–¹æ³•è°ƒç”¨sum
          return Reflect.apply(...arguments) * 2
      }
  }
  var funProxy = new Proxy(sum, twice)
  console.log(funProxy(1,2))// 6
  console.log(funProxy.call(null,1,2))// 6
  console.log(funProxy.apply(null,[1,2]))// 6
  ```

- éšè—å±æ€§æ“ä½œï¼šhas

  - `has`æ–¹æ³•ç”¨æ¥æ‹¦æˆª`HasProperty`æ“ä½œï¼Œå³åˆ¤æ–­å¯¹è±¡æ˜¯å¦å…·æœ‰æŸä¸ªå±æ€§æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šç”Ÿæ•ˆã€‚å…¸å‹çš„æ“ä½œå°±æ˜¯`in`è¿ç®—ç¬¦ã€‚ä½†æ˜¯è¿™åªä¼šæ‹¦æˆªå•ä¸ªå±æ€§çš„ in åˆ¤æ–­ï¼Œforâ€¦in æ˜¯ä¸ä¼šæ‹¦æˆªçš„ã€‚

    `has`æ–¹æ³•å¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ç›®æ ‡å¯¹è±¡ã€éœ€æŸ¥è¯¢çš„å±æ€§åã€‚

  ```js
  var obj = {
      name: 'ioo',
      price: 58,
      _value: 5800,
      _test: 'ok'
  }
  
  var handler = {
      has(target, key) {
          if (key[0] === '_') {
              return false
          }
          return key in target
      }
  }
  var hasProxy = new Proxy(obj, handler)
  console.log('name' in hasProxy)// true
  console.log('price' in hasProxy)// true
  console.log('_value' in hasProxy)// false
  console.log('_test' in hasProxy)// false
  // ä¸ä¼šæ‹¦æˆª for...in 
  for (key in hasProxy) {
      console.log(key)
  }
  // name
  // price
  // _value
  // _test
  ```

  - å¦‚æœåŸå¯¹è±¡ä¸å¯é…ç½®æˆ–ç¦æ­¢æ‰©å±•ï¼Œé‚£ä¹ˆè¿™æ˜¯ has æ‹¦æˆªä¼šæŠ¥é”™
  
  ```js
  var obj = {a: 20}
  // Object.preventExtensions()æ–¹æ³•è®©ä¸€ä¸ªå¯¹è±¡å˜çš„ä¸å¯æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯æ°¸è¿œä¸èƒ½å†æ·»åŠ æ–°çš„å±æ€§ã€‚
  Object.preventExtensions(obj)
  var proxy = new Proxy(obj1,{
      has(target, key) {
          return false
      }
  })
  console.log('a' in proxy)// Uncaught TypeError: 'has' on proxy: trap returned falsish for property 'a' but the proxy target is not extensible
  ```
  
- æ‹¦æˆª new æŒ‡ä»¤ï¼šconstruct

  - ç”¨äºæ‹¦æˆªåˆ›å»ºå¯¹è±¡çš„ new æŒ‡ä»¤

  ```js
  var handler = {
      // target æ˜¯ä¼ å…¥çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å¦‚æœè¿”å›å€¼ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ä¼šæŠ¥é”™
      construct(target, args) {
          console.log('construct')
          return new target()
      }
  }
  var proxy = new Proxy(function () {}, handler)
  new proxy// construct
  ```

- æ‹¦æˆª delete æ“ä½œï¼šdeleteProperty

  -  `deleteProperty`æ–¹æ³•ç”¨äºæ‹¦æˆª`delete`æ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•æŠ›å‡ºé”™è¯¯æˆ–è€…è¿”å›`false`ï¼Œå½“å‰å±æ€§å°±æ— æ³•è¢«`delete`å‘½ä»¤åˆ é™¤ã€‚ 

  ```js
  var handler = {
      deleteProperty(target, key) {
          delete target[key]
          console.log(`åˆ é™¤"${key}"å±æ€§æˆåŠŸ`)
          return true
      }
  }
  var obj = {
      name: 'Bill',
      age: 20
  }
  var proxy = new Proxy(obj, handler)
  delete proxy.age// åˆ é™¤"age"å±æ€§æˆåŠŸ
  console.log(proxy.age)// undefined
  ```

- æ‹¦æˆª defineProperty æ“ä½œï¼šdefineProperty

  -  `defineProperty`æ–¹æ³•æ‹¦æˆªäº†`Object.defineProperty`æ“ä½œã€‚ æ‹¦æˆªåŠ¨æ€æ·»åŠ å±æ€§çš„æ“ä½œ

  ```js
  var obj = {}
  var handler = {
      defineProperty(target, key, descriptor) {
          console.log(`<${key}>`)
          // target[key] = descriptor.value
          Reflect.defineProperty(target, key, descriptor)
          return true
      }
  }
  var proxy = new Proxy(obj, handler)
  proxy.name = 'Bill'
  ```

### Reflect

**Reflect** æ˜¯ä¸€ä¸ªå†…ç½®çš„å¯¹è±¡ï¼Œå®ƒæä¾›æ‹¦æˆª JavaScript æ“ä½œçš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ä¸[å¤„ç†å™¨å¯¹è±¡](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler)çš„æ–¹æ³•ç›¸åŒã€‚`Reflect`ä¸æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œå› æ­¤å®ƒæ˜¯ä¸å¯æ„é€ çš„ã€‚ 

ä¸å¤§å¤šæ•°å…¨å±€å¯¹è±¡ä¸åŒï¼Œ`Reflect`ä¸æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚ä½ ä¸èƒ½å°†å…¶ä¸ä¸€ä¸ª[newè¿ç®—ç¬¦](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new)ä¸€èµ·ä½¿ç”¨ï¼Œæˆ–è€…å°†`Reflect`å¯¹è±¡ä½œä¸ºä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨ã€‚`Reflect`çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼ˆå°±åƒ[`Math`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math)å¯¹è±¡ï¼‰ã€‚ 

  - `Reflect`å¯¹è±¡ä¸`Proxy`å¯¹è±¡ä¸€æ ·ï¼Œä¹Ÿæ˜¯ ES6 ä¸ºäº†æ“ä½œå¯¹è±¡è€Œæä¾›çš„æ–° APIã€‚`Reflect`å¯¹è±¡çš„è®¾è®¡ç›®çš„æœ‰è¿™æ ·å‡ ä¸ªã€‚

    - å°†`Object`å¯¹è±¡çš„ä¸€äº›æ˜æ˜¾å±äºè¯­è¨€å†…éƒ¨çš„æ–¹æ³•ï¼ˆæ¯”å¦‚`Object.defineProperty`ï¼‰ï¼Œæ”¾åˆ°`Reflect`å¯¹è±¡ä¸Šã€‚ç°é˜¶æ®µï¼ŒæŸäº›æ–¹æ³•åŒæ—¶åœ¨`Object`å’Œ`Reflect`å¯¹è±¡ä¸Šéƒ¨ç½²ï¼Œæœªæ¥çš„æ–°æ–¹æ³•å°†åªéƒ¨ç½²åœ¨`Reflect`å¯¹è±¡ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»`Reflect`å¯¹è±¡ä¸Šå¯ä»¥æ‹¿åˆ°è¯­è¨€å†…éƒ¨çš„æ–¹æ³•ã€‚
    - ä¿®æ”¹æŸäº›`Object`æ–¹æ³•çš„è¿”å›ç»“æœï¼Œè®©å…¶å˜å¾—æ›´åˆç†ã€‚æ¯”å¦‚ï¼Œ`Object.defineProperty(obj, name, desc)`åœ¨æ— æ³•å®šä¹‰å±æ€§æ—¶ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè€Œ`Reflect.defineProperty(obj, name, desc)`åˆ™ä¼šè¿”å›`false`ã€‚

    ```javascript
    // è€å†™æ³•
    try {
      Object.defineProperty(target, property, attributes);
      // success
    } catch (e) {
      // failure
    }
    
    // æ–°å†™æ³•
    if (Reflect.defineProperty(target, property, attributes)) {
      // success
    } else {
      // failure
    }
    ```

    -  è®©`Object`æ“ä½œéƒ½å˜æˆå‡½æ•°è¡Œä¸ºã€‚æŸäº›`Object`æ“ä½œæ˜¯å‘½ä»¤å¼ï¼Œæ¯”å¦‚`name in obj`å’Œ`delete obj[name]`ï¼Œè€Œ`Reflect.has(obj, name)`å’Œ`Reflect.deleteProperty(obj, name)`è®©å®ƒä»¬å˜æˆäº†å‡½æ•°è¡Œä¸ºã€‚ 

    ```javascript
    // è€å†™æ³•
    'assign' in Object // true
    
    // æ–°å†™æ³•
    Reflect.has(Object, 'assign') // true
    ```

    -  `Reflect`å¯¹è±¡çš„æ–¹æ³•ä¸`Proxy`å¯¹è±¡çš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ï¼Œåªè¦æ˜¯`Proxy`å¯¹è±¡çš„æ–¹æ³•ï¼Œå°±èƒ½åœ¨`Reflect`å¯¹è±¡ä¸Šæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ã€‚è¿™å°±è®©`Proxy`å¯¹è±¡å¯ä»¥æ–¹ä¾¿åœ°è°ƒç”¨å¯¹åº”çš„`Reflect`æ–¹æ³•ï¼Œå®Œæˆé»˜è®¤è¡Œä¸ºï¼Œä½œä¸ºä¿®æ”¹è¡Œä¸ºçš„åŸºç¡€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡`Proxy`æ€ä¹ˆä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼Œä½ æ€»å¯ä»¥åœ¨`Reflect`ä¸Šè·å–é»˜è®¤è¡Œä¸ºã€‚ 

    ```javascript
    Proxy(target, {
      set: function(target, name, value, receiver) {
        var success = Reflect.set(target, name, value, receiver);
        if (success) {
          console.log('property ' + name + ' on ' + target + ' set to ' + value);
        }
        return success;
      }
    });
    ```

    â€‹	ä¸Šé¢ä»£ç ä¸­ï¼Œ`Proxy`æ–¹æ³•æ‹¦æˆª`target`å¯¹è±¡çš„å±æ€§èµ‹å€¼è¡Œä¸ºã€‚å®ƒé‡‡ç”¨`Reflect.set`æ–¹æ³•å°†å€¼èµ‹å€¼ç»™å¯¹è±¡çš„å±æ€§ï¼Œç¡®ä¿å®ŒæˆåŸæœ‰çš„è¡Œä¸ºï¼Œç„¶åå†éƒ¨ç½²é¢å¤–çš„åŠŸèƒ½ã€‚

    ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚

    ```javascript
    var loggedObj = new Proxy(obj, {
      get(target, name) {
        console.log('get', target, name);
        return Reflect.get(target, name);
      },
      deleteProperty(target, name) {
        console.log('delete' + name);
        return Reflect.deleteProperty(target, name);
      },
      has(target, name) {
        console.log('has' + name);
        return Reflect.has(target, name);
      }
    });
    ```

    ä¸Šé¢ä»£ç ä¸­ï¼Œæ¯ä¸€ä¸ª`Proxy`å¯¹è±¡çš„æ‹¦æˆªæ“ä½œï¼ˆ`get`ã€`delete`ã€`has`ï¼‰ï¼Œå†…éƒ¨éƒ½è°ƒç”¨å¯¹åº”çš„`Reflect`æ–¹æ³•ï¼Œä¿è¯åŸç”Ÿè¡Œä¸ºèƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œã€‚æ·»åŠ çš„å·¥ä½œï¼Œå°±æ˜¯å°†æ¯ä¸€ä¸ªæ“ä½œè¾“å‡ºä¸€è¡Œæ—¥å¿—ã€‚

    æœ‰äº†`Reflect`å¯¹è±¡ä»¥åï¼Œå¾ˆå¤šæ“ä½œä¼šæ›´æ˜“è¯»ã€‚

    ```javascript
    // è€å†™æ³•
    Function.prototype.apply.call(Math.floor, undefined, [1.75]) // 1
    
    // æ–°å†™æ³•
    Reflect.apply(Math.floor, undefined, [1.75]) // 1
    ```

### Promise

è§ Nodejs ç¬”è®°ï¼Œæœ‰è¯¦ç»†çš„ç¬”è®°

å¦‚æœ‰è¿˜æœ‰é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒæœ¬æ–‡æ¡£å‚è€ƒä¹¦ç± http://es6.ruanyifeng.com/

### Iterator å’Œ for...of å¾ªç¯

JavaScript åŸæœ‰çš„è¡¨ç¤ºâ€œé›†åˆâ€çš„æ•°æ®ç»“æ„ï¼Œä¸»è¦æ˜¯æ•°ç»„ï¼ˆ`Array`ï¼‰å’Œå¯¹è±¡ï¼ˆ`Object`ï¼‰ï¼ŒES6 åˆæ·»åŠ äº†`Map`å’Œ`Set`ã€‚è¿™æ ·å°±æœ‰äº†å››ç§æ•°æ®é›†åˆï¼Œç”¨æˆ·è¿˜å¯ä»¥ç»„åˆä½¿ç”¨å®ƒä»¬ï¼Œå®šä¹‰è‡ªå·±çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚æ•°ç»„çš„æˆå‘˜æ˜¯`Map`ï¼Œ`Map`çš„æˆå‘˜æ˜¯å¯¹è±¡ã€‚è¿™æ ·å°±éœ€è¦ä¸€ç§ç»Ÿä¸€çš„æ¥å£æœºåˆ¶ï¼Œæ¥å¤„ç†æ‰€æœ‰ä¸åŒçš„æ•°æ®ç»“æ„ã€‚

éå†å™¨ï¼ˆIteratorï¼‰å°±æ˜¯è¿™æ ·ä¸€ç§æœºåˆ¶ã€‚å®ƒæ˜¯ä¸€ç§æ¥å£ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚ä»»ä½•æ•°æ®ç»“æ„åªè¦éƒ¨ç½² Iterator æ¥å£ï¼Œå°±å¯ä»¥å®Œæˆéå†æ“ä½œï¼ˆå³ä¾æ¬¡å¤„ç†è¯¥æ•°æ®ç»“æ„çš„æ‰€æœ‰æˆå‘˜ï¼‰ã€‚

Iterator çš„ä½œç”¨æœ‰ä¸‰ä¸ªï¼šä¸€æ˜¯ä¸ºå„ç§æ•°æ®ç»“æ„ï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„ã€ç®€ä¾¿çš„è®¿é—®æ¥å£ï¼›äºŒæ˜¯ä½¿å¾—æ•°æ®ç»“æ„çš„æˆå‘˜èƒ½å¤ŸæŒ‰æŸç§æ¬¡åºæ’åˆ—ï¼›ä¸‰æ˜¯ ES6 åˆ›é€ äº†ä¸€ç§æ–°çš„éå†å‘½ä»¤`for...of`å¾ªç¯ï¼ŒIterator æ¥å£ä¸»è¦ä¾›`for...of`æ¶ˆè´¹ã€‚

Iterator çš„éå†è¿‡ç¨‹æ˜¯è¿™æ ·çš„ã€‚

ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ï¼ŒæŒ‡å‘å½“å‰æ•°æ®ç»“æ„çš„èµ·å§‹ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéå†å™¨å¯¹è±¡æœ¬è´¨ä¸Šï¼Œå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ã€‚

ï¼ˆ2ï¼‰ç¬¬ä¸€æ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„`next`æ–¹æ³•ï¼Œå¯ä»¥å°†æŒ‡é’ˆæŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ã€‚

ï¼ˆ3ï¼‰ç¬¬äºŒæ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„`next`æ–¹æ³•ï¼ŒæŒ‡é’ˆå°±æŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬äºŒä¸ªæˆå‘˜ã€‚

ï¼ˆ4ï¼‰ä¸æ–­è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„`next`æ–¹æ³•ï¼Œç›´åˆ°å®ƒæŒ‡å‘æ•°æ®ç»“æ„çš„ç»“æŸä½ç½®ã€‚

æ¯ä¸€æ¬¡è°ƒç”¨`next`æ–¹æ³•ï¼Œéƒ½ä¼šè¿”å›æ•°æ®ç»“æ„çš„å½“å‰æˆå‘˜çš„ä¿¡æ¯ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯è¿”å›ä¸€ä¸ªåŒ…å«`value`å’Œ`done`ä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ã€‚å…¶ä¸­ï¼Œ`value`å±æ€§æ˜¯å½“å‰æˆå‘˜çš„å€¼ï¼Œ`done`å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºéå†æ˜¯å¦ç»“æŸã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿ`next`æ–¹æ³•è¿”å›å€¼çš„ä¾‹å­ã€‚

```javascript
var it = makeIterator(['a', 'b']);

it.next() // { value: "a", done: false }
it.next() // { value: "b", done: false }
it.next() // { value: undefined, done: true }

function makeIterator(array) {
  var nextIndex = 0;
  return {
    next: function() {
      return nextIndex < array.length ?
        {value: array[nextIndex++], done: false} :
        {value: undefined, done: true};
    }
  };
}
```

â€‹	ä¸Šé¢ä»£ç å®šä¹‰äº†ä¸€ä¸ª`makeIterator`å‡½æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªéå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œä½œç”¨å°±æ˜¯è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚å¯¹æ•°ç»„`['a', 'b']`æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå°±ä¼šè¿”å›è¯¥æ•°ç»„çš„éå†å™¨å¯¹è±¡ï¼ˆå³æŒ‡é’ˆå¯¹è±¡ï¼‰`it`ã€‚

â€‹	æŒ‡é’ˆå¯¹è±¡çš„`next`æ–¹æ³•ï¼Œç”¨æ¥ç§»åŠ¨æŒ‡é’ˆã€‚å¼€å§‹æ—¶ï¼ŒæŒ‡é’ˆæŒ‡å‘æ•°ç»„çš„å¼€å§‹ä½ç½®ã€‚ç„¶åï¼Œæ¯æ¬¡è°ƒç”¨`next`æ–¹æ³•ï¼ŒæŒ‡é’ˆå°±ä¼šæŒ‡å‘æ•°ç»„çš„ä¸‹ä¸€ä¸ªæˆå‘˜ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼ŒæŒ‡å‘`a`ï¼›ç¬¬äºŒæ¬¡è°ƒç”¨ï¼ŒæŒ‡å‘`b`ã€‚

â€‹	`next`æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºå½“å‰æ•°æ®æˆå‘˜çš„ä¿¡æ¯ã€‚è¿™ä¸ªå¯¹è±¡å…·æœ‰`value`å’Œ`done`ä¸¤ä¸ªå±æ€§ï¼Œ`value`å±æ€§è¿”	å›å½“å‰ä½ç½®çš„æˆå‘˜ï¼Œ`done`å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºéå†æ˜¯å¦ç»“æŸï¼Œå³æ˜¯å¦è¿˜æœ‰å¿…è¦å†ä¸€æ¬¡è°ƒç”¨`next`æ–¹æ³•ã€‚

â€‹	æ€»ä¹‹ï¼Œè°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„`next`æ–¹æ³•ï¼Œå°±å¯ä»¥éå†äº‹å…ˆç»™å®šçš„æ•°æ®ç»“æ„ã€‚

â€‹	å¯¹äºéå†å™¨å¯¹è±¡æ¥è¯´ï¼Œ`done: false`å’Œ`value: undefined`å±æ€§éƒ½æ˜¯å¯ä»¥çœç•¥çš„ï¼Œå› æ­¤ä¸Šé¢çš„`makeIterator`å‡½æ•°å¯ä»¥ç®€å†™æˆä¸‹é¢çš„å½¢å¼ã€‚

```javascript
function makeIterator(array) {
  var nextIndex = 0;
  return {
    next: function() {
      return nextIndex < array.length ?
        {value: array[nextIndex++]} :
        {done: true};
    }
  };
}
```

â€‹	ç”±äº Iterator åªæ˜¯æŠŠæ¥å£è§„æ ¼åŠ åˆ°æ•°æ®ç»“æ„ä¹‹ä¸Šï¼Œæ‰€ä»¥ï¼Œéå†å™¨ä¸å®ƒæ‰€éå†çš„é‚£ä¸ªæ•°æ®ç»“æ„ï¼Œå®é™…ä¸Šæ˜¯åˆ†å¼€çš„ï¼Œå®Œå…¨å¯ä»¥å†™å‡ºæ²¡æœ‰å¯¹åº”æ•°æ®ç»“æ„çš„éå†å™¨å¯¹è±¡ï¼Œæˆ–è€…è¯´ç”¨éå†å™¨å¯¹è±¡æ¨¡æ‹Ÿå‡ºæ•°æ®ç»“æ„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ— é™è¿è¡Œçš„éå†å™¨å¯¹è±¡çš„ä¾‹å­ã€‚

```javascript
var it = idMaker();

it.next().value // 0
it.next().value // 1
it.next().value // 2
// ...

function idMaker() {
  var index = 0;

  return {
    next: function() {
      return {value: index++, done: false};
    }
  };
}
```

â€‹	ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œéå†å™¨ç”Ÿæˆå‡½æ•°`idMaker`ï¼Œè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼ˆå³æŒ‡é’ˆå¯¹è±¡ï¼‰ã€‚ä½†æ˜¯å¹¶æ²¡æœ‰å¯¹åº”çš„æ•°æ®ç»“æ„ï¼Œæˆ–è€…è¯´ï¼Œéå†å™¨å¯¹è±¡è‡ªå·±æè¿°äº†ä¸€ä¸ªæ•°æ®ç»“æ„å‡ºæ¥ã€‚

â€‹	å¦‚æœä½¿ç”¨ TypeScript çš„å†™æ³•ï¼Œéå†å™¨æ¥å£ï¼ˆIterableï¼‰ã€æŒ‡é’ˆå¯¹è±¡ï¼ˆIteratorï¼‰å’Œ`next`æ–¹æ³•è¿”å›å€¼çš„è§„æ ¼å¯ä»¥æè¿°å¦‚ä¸‹ã€‚

```typescript
interface Iterable {
  [Symbol.iterator]() : Iterator,
}

interface Iterator {
  next(value?: any) : IterationResult,
}

interface IterationResult {
  value: any,
  done: boolean,
}
```

**é»˜è®¤ Iterator æ¥å£**

- Iterator æ¥å£çš„ç›®çš„ï¼Œå°±æ˜¯ä¸ºæ‰€æœ‰æ•°æ®ç»“æ„ï¼Œæä¾›äº†ä¸€ç§ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ï¼Œå³`for...of`å¾ªç¯ï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ã€‚å½“ä½¿ç”¨`for...of`å¾ªç¯éå†æŸç§æ•°æ®ç»“æ„æ—¶ï¼Œè¯¥å¾ªç¯ä¼šè‡ªåŠ¨å»å¯»æ‰¾ Iterator æ¥å£ã€‚

  ä¸€ç§æ•°æ®ç»“æ„åªè¦éƒ¨ç½²äº† Iterator æ¥å£ï¼Œæˆ‘ä»¬å°±ç§°è¿™ç§æ•°æ®ç»“æ„æ˜¯â€œå¯éå†çš„â€ï¼ˆiterableï¼‰ã€‚

  ES6 è§„å®šï¼Œé»˜è®¤çš„ Iterator æ¥å£éƒ¨ç½²åœ¨æ•°æ®ç»“æ„çš„`Symbol.iterator`å±æ€§ï¼Œæˆ–è€…è¯´ï¼Œä¸€ä¸ªæ•°æ®ç»“æ„åªè¦å…·æœ‰`Symbol.iterator`å±æ€§ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯â€œå¯éå†çš„â€ï¼ˆiterableï¼‰ã€‚`Symbol.iterator`å±æ€§æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå°±æ˜¯å½“å‰æ•°æ®ç»“æ„é»˜è®¤çš„éå†å™¨ç”Ÿæˆå‡½æ•°ã€‚æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªéå†å™¨ã€‚è‡³äºå±æ€§å`Symbol.iterator`ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿”å›`Symbol`å¯¹è±¡çš„`iterator`å±æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªé¢„å®šä¹‰å¥½çš„ã€ç±»å‹ä¸º Symbol çš„ç‰¹æ®Šå€¼ï¼Œæ‰€ä»¥è¦æ”¾åœ¨æ–¹æ‹¬å·å†…ï¼ˆå‚è§ã€ŠSymbolã€‹ä¸€ç« ï¼‰ã€‚

  ```javascript
  const obj = {
    [Symbol.iterator] : function () {
      return {
        next: function () {
          return {
            value: 1,
            done: true
          };
        }
      };
    }
  };
  ```

  ä¸Šé¢ä»£ç ä¸­ï¼Œå¯¹è±¡`obj`æ˜¯å¯éå†çš„ï¼ˆiterableï¼‰ï¼Œå› ä¸ºå…·æœ‰`Symbol.iterator`å±æ€§ã€‚æ‰§è¡Œè¿™ä¸ªå±æ€§ï¼Œä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚è¯¥å¯¹è±¡çš„æ ¹æœ¬ç‰¹å¾å°±æ˜¯å…·æœ‰`next`æ–¹æ³•ã€‚æ¯æ¬¡è°ƒç”¨`next`æ–¹æ³•ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªä»£è¡¨å½“å‰æˆå‘˜çš„ä¿¡æ¯å¯¹è±¡ï¼Œå…·æœ‰`value`å’Œ`done`ä¸¤ä¸ªå±æ€§ã€‚

  ES6 çš„æœ‰äº›æ•°æ®ç»“æ„åŸç”Ÿå…·å¤‡ Iterator æ¥å£ï¼ˆæ¯”å¦‚æ•°ç»„ï¼‰ï¼Œå³ä¸ç”¨ä»»ä½•å¤„ç†ï¼Œå°±å¯ä»¥è¢«`for...of`å¾ªç¯éå†ã€‚åŸå› åœ¨äºï¼Œè¿™äº›æ•°æ®ç»“æ„åŸç”Ÿéƒ¨ç½²äº†`Symbol.iterator`å±æ€§ï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œå¦å¤–ä¸€äº›æ•°æ®ç»“æ„æ²¡æœ‰ï¼ˆæ¯”å¦‚å¯¹è±¡ï¼‰ã€‚å‡¡æ˜¯éƒ¨ç½²äº†`Symbol.iterator`å±æ€§çš„æ•°æ®ç»“æ„ï¼Œå°±ç§°ä¸ºéƒ¨ç½²äº†éå†å™¨æ¥å£ã€‚è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚

  åŸç”Ÿå…·å¤‡ Iterator æ¥å£çš„æ•°æ®ç»“æ„å¦‚ä¸‹ã€‚

  - Array
  - Map
  - Set
  - String
  - TypedArray
  - å‡½æ•°çš„ arguments å¯¹è±¡
  - NodeList å¯¹è±¡

  ä¸‹é¢çš„ä¾‹å­æ˜¯æ•°ç»„çš„`Symbol.iterator`å±æ€§ã€‚

  ```javascript
  let arr = ['a', 'b', 'c'];
  let iter = arr[Symbol.iterator]();
  
  iter.next() // { value: 'a', done: false }
  iter.next() // { value: 'b', done: false }
  iter.next() // { value: 'c', done: false }
  iter.next() // { value: undefined, done: true }
  ```

  ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡`arr`æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŸç”Ÿå°±å…·æœ‰éå†å™¨æ¥å£ï¼Œéƒ¨ç½²åœ¨`arr`çš„`Symbol.iterator`å±æ€§ä¸Šé¢ã€‚æ‰€ä»¥ï¼Œè°ƒç”¨è¿™ä¸ªå±æ€§ï¼Œå°±å¾—åˆ°éå†å™¨å¯¹è±¡ã€‚

  å¯¹äºåŸç”Ÿéƒ¨ç½² Iterator æ¥å£çš„æ•°æ®ç»“æ„ï¼Œä¸ç”¨è‡ªå·±å†™éå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œ`for...of`å¾ªç¯ä¼šè‡ªåŠ¨éå†å®ƒä»¬ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå…¶ä»–æ•°æ®ç»“æ„ï¼ˆä¸»è¦æ˜¯å¯¹è±¡ï¼‰çš„ Iterator æ¥å£ï¼Œéƒ½éœ€è¦è‡ªå·±åœ¨`Symbol.iterator`å±æ€§ä¸Šé¢éƒ¨ç½²ï¼Œè¿™æ ·æ‰ä¼šè¢«`for...of`å¾ªç¯éå†ã€‚

  å¯¹è±¡ï¼ˆObjectï¼‰ä¹‹æ‰€ä»¥æ²¡æœ‰é»˜è®¤éƒ¨ç½² Iterator æ¥å£ï¼Œæ˜¯å› ä¸ºå¯¹è±¡çš„å“ªä¸ªå±æ€§å…ˆéå†ï¼Œå“ªä¸ªå±æ€§åéå†æ˜¯ä¸ç¡®å®šçš„ï¼Œéœ€è¦å¼€å‘è€…æ‰‹åŠ¨æŒ‡å®šã€‚æœ¬è´¨ä¸Šï¼Œéå†å™¨æ˜¯ä¸€ç§çº¿æ€§å¤„ç†ï¼Œå¯¹äºä»»ä½•éçº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œéƒ¨ç½²éå†å™¨æ¥å£ï¼Œå°±ç­‰äºéƒ¨ç½²ä¸€ç§çº¿æ€§è½¬æ¢ã€‚ä¸è¿‡ï¼Œä¸¥æ ¼åœ°è¯´ï¼Œå¯¹è±¡éƒ¨ç½²éå†å™¨æ¥å£å¹¶ä¸æ˜¯å¾ˆå¿…è¦ï¼Œå› ä¸ºè¿™æ—¶å¯¹è±¡å®é™…ä¸Šè¢«å½“ä½œ Map ç»“æ„ä½¿ç”¨ï¼ŒES5 æ²¡æœ‰ Map ç»“æ„ï¼Œè€Œ ES6 åŸç”Ÿæä¾›äº†ã€‚

  ä¸€ä¸ªå¯¹è±¡å¦‚æœè¦å…·å¤‡å¯è¢«`for...of`å¾ªç¯è°ƒç”¨çš„ Iterator æ¥å£ï¼Œå°±å¿…é¡»åœ¨`Symbol.iterator`çš„å±æ€§ä¸Šéƒ¨ç½²éå†å™¨ç”Ÿæˆæ–¹æ³•ï¼ˆåŸå‹é“¾ä¸Šçš„å¯¹è±¡å…·æœ‰è¯¥æ–¹æ³•ä¹Ÿå¯ï¼‰ã€‚

  ```javascript
  class RangeIterator {
    constructor(start, stop) {
      this.value = start;
      this.stop = stop;
    }
  
    [Symbol.iterator]() { return this; }
  
    next() {
      var value = this.value;
      if (value < this.stop) {
        this.value++;
        return {done: false, value: value};
      }
      return {done: true, value: undefined};
    }
  }
  
  function range(start, stop) {
    return new RangeIterator(start, stop);
  }
  
  for (var value of range(0, 3)) {
    console.log(value); // 0, 1, 2
  }
  ```

  ä¸Šé¢ä»£ç æ˜¯ä¸€ä¸ªç±»éƒ¨ç½² Iterator æ¥å£çš„å†™æ³•ã€‚`Symbol.iterator`å±æ€§å¯¹åº”ä¸€ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œåè¿”å›å½“å‰å¯¹è±¡çš„éå†å™¨å¯¹è±¡ã€‚

  ä¸‹é¢æ˜¯é€šè¿‡éå†å™¨å®ç°æŒ‡é’ˆç»“æ„çš„ä¾‹å­ã€‚

  ```javascript
  function Obj(value) {
    this.value = value;
    this.next = null;
  }
  
  Obj.prototype[Symbol.iterator] = function() {
    var iterator = { next: next };
  
    var current = this;
  
    function next() {
      if (current) {
        var value = current.value;
        current = current.next;
        return { done: false, value: value };
      } else {
        return { done: true };
      }
    }
    return iterator;
  }
  
  var one = new Obj(1);
  var two = new Obj(2);
  var three = new Obj(3);
  
  one.next = two;
  two.next = three;
  
  for (var i of one){
    console.log(i); // 1, 2, 3
  }
  ```

  ä¸Šé¢ä»£ç é¦–å…ˆåœ¨æ„é€ å‡½æ•°çš„åŸå‹é“¾ä¸Šéƒ¨ç½²`Symbol.iterator`æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ä¼šè¿”å›éå†å™¨å¯¹è±¡`iterator`ï¼Œè°ƒç”¨è¯¥å¯¹è±¡çš„`next`æ–¹æ³•ï¼Œåœ¨è¿”å›ä¸€ä¸ªå€¼çš„åŒæ—¶ï¼Œè‡ªåŠ¨å°†å†…éƒ¨æŒ‡é’ˆç§»åˆ°ä¸‹ä¸€ä¸ªå®ä¾‹ã€‚

  ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¸ºå¯¹è±¡æ·»åŠ  Iterator æ¥å£çš„ä¾‹å­ã€‚

  ```javascript
  let obj = {
    data: [ 'hello', 'world' ],
    [Symbol.iterator]() {
      const self = this;
      let index = 0;
      return {
        next() {
          if (index < self.data.length) {
            return {
              value: self.data[index++],
              done: false
            };
          } else {
            return { value: undefined, done: true };
          }
        }
      };
    }
  };
  ```

  å¯¹äºç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ˆå­˜åœ¨æ•°å€¼é”®åå’Œ`length`å±æ€§ï¼‰ï¼Œéƒ¨ç½² Iterator æ¥å£ï¼Œæœ‰ä¸€ä¸ªç®€ä¾¿æ–¹æ³•ï¼Œå°±æ˜¯`Symbol.iterator`æ–¹æ³•ç›´æ¥å¼•ç”¨æ•°ç»„çš„ Iterator æ¥å£ã€‚

  ```javascript
  NodeList.prototype[Symbol.iterator] = Array.prototype[Symbol.iterator];
  // æˆ–è€…
  NodeList.prototype[Symbol.iterator] = [][Symbol.iterator];
  
  [...document.querySelectorAll('div')] // å¯ä»¥æ‰§è¡Œäº†
  ```

  NodeList å¯¹è±¡æ˜¯ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œæœ¬æ¥å°±å…·æœ‰éå†æ¥å£ï¼Œå¯ä»¥ç›´æ¥éå†ã€‚ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†å®ƒçš„éå†æ¥å£æ”¹æˆæ•°ç»„çš„`Symbol.iterator`å±æ€§ï¼Œå¯ä»¥çœ‹åˆ°æ²¡æœ‰ä»»ä½•å½±å“ã€‚

  ä¸‹é¢æ˜¯å¦ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡è°ƒç”¨æ•°ç»„çš„`Symbol.iterator`æ–¹æ³•çš„ä¾‹å­ã€‚

  ```javascript
  let iterable = {
    0: 'a',
    1: 'b',
    2: 'c',
    length: 3,
    [Symbol.iterator]: Array.prototype[Symbol.iterator]
  };
  for (let item of iterable) {
    console.log(item); // 'a', 'b', 'c'
  }
  ```

  æ³¨æ„ï¼Œæ™®é€šå¯¹è±¡éƒ¨ç½²æ•°ç»„çš„`Symbol.iterator`æ–¹æ³•ï¼Œå¹¶æ— æ•ˆæœã€‚

  ```javascript
  let iterable = {
    a: 'a',
    b: 'b',
    c: 'c',
    length: 3,
    [Symbol.iterator]: Array.prototype[Symbol.iterator]
  };
  for (let item of iterable) {
    console.log(item); // undefined, undefined, undefined
  }
  ```

  å¦‚æœ`Symbol.iterator`æ–¹æ³•å¯¹åº”çš„ä¸æ˜¯éå†å™¨ç”Ÿæˆå‡½æ•°ï¼ˆå³ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼‰ï¼Œè§£é‡Šå¼•æ“å°†ä¼šæŠ¥é”™ã€‚

  ```javascript
  var obj = {};
  
  obj[Symbol.iterator] = () => 1;
  
  [...obj] // TypeError: [] is not a function
  ```

  ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡`obj`çš„`Symbol.iterator`æ–¹æ³•å¯¹åº”çš„ä¸æ˜¯éå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œå› æ­¤æŠ¥é”™ã€‚

  æœ‰äº†éå†å™¨æ¥å£ï¼Œæ•°æ®ç»“æ„å°±å¯ä»¥ç”¨`for...of`å¾ªç¯éå†ï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`while`å¾ªç¯éå†ã€‚

  ```javascript
  var $iterator = ITERABLE[Symbol.iterator]();
  var $result = $iterator.next();
  while (!$result.done) {
    var x = $result.value;
    // ...
    $result = $iterator.next();
  }
  ```

  ä¸Šé¢ä»£ç ä¸­ï¼Œ`ITERABLE`ä»£è¡¨æŸç§å¯éå†çš„æ•°æ®ç»“æ„ï¼Œ`$iterator`æ˜¯å®ƒçš„éå†å™¨å¯¹è±¡ã€‚éå†å™¨å¯¹è±¡æ¯æ¬¡ç§»åŠ¨æŒ‡é’ˆï¼ˆ`next`æ–¹æ³•ï¼‰ï¼Œéƒ½æ£€æŸ¥ä¸€ä¸‹è¿”å›å€¼çš„`done`å±æ€§ï¼Œå¦‚æœéå†è¿˜æ²¡ç»“æŸï¼Œå°±ç§»åŠ¨éå†å™¨å¯¹è±¡çš„æŒ‡é’ˆåˆ°ä¸‹ä¸€æ­¥ï¼ˆ`next`æ–¹æ³•ï¼‰ï¼Œä¸æ–­å¾ªç¯ã€‚

### Generatorå‡½æ•°

Generator å‡½æ•°æ˜¯ ES6 æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œè¯­æ³•è¡Œä¸ºä¸ä¼ ç»Ÿå‡½æ•°å®Œå…¨ä¸åŒã€‚ 

Generator å‡½æ•°æœ‰å¤šç§ç†è§£è§’åº¦ã€‚è¯­æ³•ä¸Šï¼Œé¦–å…ˆå¯ä»¥æŠŠå®ƒç†è§£æˆï¼ŒGenerator å‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚

æ‰§è¡Œ Generator å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒGenerator å‡½æ•°é™¤äº†çŠ¶æ€æœºï¼Œè¿˜æ˜¯ä¸€ä¸ªéå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ã€‚è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå† Generator å‡½æ•°å†…éƒ¨çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚

å½¢å¼ä¸Šï¼ŒGenerator å‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç‰¹å¾ã€‚ä¸€æ˜¯ï¼Œ`function`å…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå·ï¼›äºŒæ˜¯ï¼Œå‡½æ•°ä½“å†…éƒ¨ä½¿ç”¨`yield`è¡¨è¾¾å¼ï¼Œå®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€ï¼ˆ`yield`åœ¨è‹±è¯­é‡Œçš„æ„æ€å°±æ˜¯â€œäº§å‡ºâ€ï¼‰ã€‚

```js
function* helloWorldGenerator() {
    console.log('ç¬¬ä¸€æ¬¡')
    yield 'hello'
    console.log('ç¬¬äºŒæ¬¡')
    yield 'world'
    console.log('ç¬¬ä¸‰æ¬¡')
    return 'ending'// returnå¯ä»¥çœ‹æˆæ˜¯æœ€åä¸€ä¸ªçŠ¶æ€
}
// Generator è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡(Iterator)
var gen = helloWorldGenerator()
// æ¯æ¬¡è°ƒç”¨nextæ–¹æ³•éƒ½æ‰§è¡Œä¸€ä¸ªyieldå‰çš„è¯­å¥ï¼Œå¹¶æŠŠæ­¤æ—¶yieldå®šä¹‰çš„å€¼å½“è¿”å›å€¼è¿”å›
console.log(gen.next())
// ç¬¬ä¸€æ¬¡
// {value: "hello", done: false}
console.log(gen.next())
// ç¬¬äºŒæ¬¡
// {value: "world", done: false}
console.log(gen.next())
// ç¬¬ä¸‰æ¬¡
// {value: "ending", done: true}
console.log(gen.next())
// {value: undefined, done: true}
```

- yield è¯­å¥

  - æˆ‘æ„Ÿè§‰å°±æ˜¯ return çš„å†™æ³•ï¼Œä½†æ˜¯åˆæœ‰ä¸åŒ

  ```js
  function sum(...values) {
      var n = 0
      for (let v of values) {
          n += v
      }
      console.log('sum')
      return n
  }
  function* gen() {
      yield 10 + 20
      yield 10 * sum(1, 2, 3, 4)
  }
  var obj = gen()
  console.log(obj.next())
  console.log(obj.next())
  ```

  - Generator å‡½æ•°ä¹Ÿå¯ä»¥ä¸ç”¨ yieldï¼Œè¿™æ · Generator å°±å˜æˆäº†æš‚ç¼“æ‰§è¡Œçš„å‡½æ•°ã€‚

  ```js
  function* fun() {
      console.log('fun')
  }
  // å› ä¸ºæ²¡æœ‰yield æœ‰ç§æ²¡æœ‰è¿”å›å€¼çš„å‡½æ•°è°ƒç”¨çš„æ„Ÿè§‰
  var obj1 = fun()
  obj1.next()
  ```

  - yield ç”¨åœ¨ä¸€ä¸ªè¡¨è¾¾å¼ä¸­ï¼Œå¿…é¡»æ”¾åœ¨åœ†æ‹¬å·é‡Œ

  ```js
  function* gen() {
      // console.log('Hello' + yield 'world') // Error
      console.log('Hello' + (yield 'world'))
  }
  var obj = gen()
  obj.next()// æ²¡è¾“å‡ºï¼Œå› ä¸ºçŠ¶æ€æœºåœ¨æ‰§è¡Œåˆ° yield è¿”å›åå°±æš‚åœäº†
  obj.next()// Helloundefined ç»§ç»­æ‰§è¡Œä¸Šä¸€æ­¥æ²¡æ‰§è¡Œå®Œçš„ä»£ç ï¼Œåˆå› ä¸º yieldè¯­å¥æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥undefinedã€‚æœ‰ç§æ‰“æ–­ç‚¹çš„æ„Ÿè§‰
  ```

  - yield è¯­å¥ç”¨ä½œå‡½æ•°å‚æ•°æˆ–ç”¨äºèµ‹å€¼è¡¨è¾¾å¼çš„å³è¾¹ï¼Œå¯ä»¥ä¸åŠ æ‹¬å·

  ```js
  function* gen() {
      console.log(sum(yield 1, yield 2))
      var input = yield 20
  }
  var obj = gen()
  obj.next()// æ²¡è¾“å‡º
  obj.next()// æ²¡è¾“å‡º
  obj.next()// NaNï¼Œå› ä¸ºæ˜¯undefined + undefinedï¼Œæ‰€ä»¥æ˜¯ NaN
  ```

  æ³¨ï¼šæ™®é€šå‡½æ•°ä¸èƒ½ç”¨ yield å½“åš returnï¼Œè¿™æ ·åšä¼šæŠ›å‡ºå¼‚å¸¸

- next æ–¹æ³•çš„å‚æ•°

  ```js
  function* gen() {
      var n = yield 20
      console.log(n)
  }
  var obj = gen()
  obj.next()
  obj.next(200)// ç»™!!ä¸Šä¸€ä¸ª!!yieldè¿”å›çš„åœ°æ–¹ è¿”å›å‚æ•°ï¼Œå³ç»™ yield è¿”å›å€¼
  
  function* gen() {
      for (var i = 0; true; i++) {
          var reset = yield i
          if (reset) {
              i = -1
          }
      }
  }
  
  var obj = gen()
  console.log(obj.next().value)// 0
  console.log(obj.next().value)// 1
  console.log(obj.next().value)// 2
  console.log(obj.next(true).value)// 0
  console.log(obj.next().value)// 1
  console.log(obj.next().value)// 2
  console.log(obj.next().value)// 3
  ```

- for â€¦ of è‡ªåŠ¨åˆ‡æ¢çŠ¶æ€

  - å› ä¸º Generator å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª Iterator å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨  forâ€¦of éå†

  ```js
  function* gen() {
      yield 'a'
      yield 'b'
      yield 'c'
      yield 'd'
      return 'x'
  }
  for (var n of gen()) {
      console.log(n)
  }
  // a b c d æ²¡æœ‰ x å› ä¸ºåˆ° return çš„æ—¶å€™ï¼Œdone ä¸º trueï¼Œå°±ä¸è¿”å›ç»™ n äº†
  
  // æ–æ³¢é‚£å¥‘æ•°åˆ— F(1)=1ï¼ŒF(2)=1, F(n)=F(n-1)+F(n-2)ï¼ˆn>=3ï¼ŒnâˆˆN*ï¼‰
  function* fibonacci() {
      let [prev, curr] = [0, 1]
      while (true) {
          [prev, curr] = [curr, curr + prev]
          yield curr// ç¬¬ä¸€æ¬¡è¾“å‡ºæ˜¯ prev = 1, curr = 1,ç¬¦åˆæ–æ³¢é‚£å¥‘æ•°åˆ—
      }
  }
  var obj = fibonacci()
  console.log(obj.next().value)// 1
  console.log(obj.next().value)// 2
  console.log(obj.next().value)// 3
  console.log(obj.next().value)// 5
  ```

  - å¯ä»¥é€šè¿‡ Generator å‡½æ•°æŠŠ Obeject ç”¨ forâ€¦of éå†

  ```js
  function* objectEntries(obj) {
      let propKeys = Reflect.ownKeys(obj)
      for (let propKey of propKeys) {
          yield [propKey, obj[propKey]]
      }
  }
  var obj = {name:'Bill', age: 12}
  for (let [key, value] of objectEntries(obj)) {
      console.log(`${key}: ${value}`)
  }
  // name: Bill
  // age: 12
  ```

- throw æ–¹æ³•

  -  Generator å‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œéƒ½æœ‰ä¸€ä¸ª`throw`æ–¹æ³•ï¼Œå¯ä»¥åœ¨å‡½æ•°ä½“å¤–æŠ›å‡ºé”™è¯¯ï¼Œç„¶ååœ¨ Generator å‡½æ•°ä½“å†…æ•è·ã€‚ 

  ```javascript
  var g = function* () {
    try {
      yield;
    } catch (e) {
      console.log('å†…éƒ¨æ•è·', e);
    }
  };
  
  var i = g();
  i.next();
  
  try {
    i.throw('a');
    i.throw('b');
  } catch (e) {
    console.log('å¤–éƒ¨æ•è·', e);
  }
  // å†…éƒ¨æ•è· a
  // å¤–éƒ¨æ•è· b
  ```

  ä¸Šé¢ä»£ç ä¸­ï¼Œéå†å™¨å¯¹è±¡`i`è¿ç»­æŠ›å‡ºä¸¤ä¸ªé”™è¯¯ã€‚ç¬¬ä¸€ä¸ªé”™è¯¯è¢« Generator å‡½æ•°ä½“å†…çš„`catch`è¯­å¥æ•è·ã€‚`i`ç¬¬äºŒæ¬¡æŠ›å‡ºé”™è¯¯ï¼Œç”±äº Generator å‡½æ•°å†…éƒ¨çš„`catch`è¯­å¥å·²ç»æ‰§è¡Œè¿‡äº†ï¼Œä¸ä¼šå†æ•æ‰åˆ°è¿™ä¸ªé”™è¯¯äº†ï¼Œæ‰€ä»¥è¿™ä¸ªé”™è¯¯å°±è¢«æŠ›å‡ºäº† Generator å‡½æ•°ä½“ï¼Œè¢«å‡½æ•°ä½“å¤–çš„`catch`è¯­å¥æ•è·ã€‚

  - æˆ‘ä»¬å¯ä»¥é€šè¿‡ throw è¯­å¥æå‰ç»“æŸ Generator çš„çŠ¶æ€
- ä½†æ˜¯é€šå¸¸éƒ½æ˜¯ç”¨ return ç»“æŸçš„
  
  ```js
  function fun(s) {
      console.log(s + s)
  }
  function* gen() {
      try {
          var a = yield fun('a')
          var b = yield fun('b')
          var c = yield fun('c')
      } catch(e) {
          console.log(e)
      }
  }
  var obj = gen()
  obj.next()// aa
  obj.next()// bb
  obj.throw('stop')// stop
  ```

- return æ–¹æ³•

  - ç›´æ¥æŠŠè¿”å›çš„å¯¹è±¡ done å˜ä¸º trueã€‚
  - æ²¡æœ‰ finally æˆ–è€… finally é‡Œæ²¡æœ‰ yield æ‰è¿”å› return çš„å‚æ•°ï¼Œä¸ç„¶ç­‰æ‰§è¡Œå®Œ finally é‡Œçš„æ‰€æœ‰ yield æ‰è¿”å› return çš„å‚æ•°ã€‚


  ```js
  function* gen() {
      yield 'a'
      yield 'b'
      yield 'c'
  }

  var obj = gen()
  console.log(obj.next())// {value: "a", done: false}
  console.log(obj.return('hello world'))// {value: "hello world", done: true}
  console.log(obj.next())// {value: undefined, done: true}
  ```

â€‹	å¦‚æœ Generator å‡½æ•°å†…éƒ¨æœ‰`try...finally`ä»£ç å—ï¼Œä¸”æ­£åœ¨æ‰§è¡Œ`try`ä»£ç å—ï¼Œé‚£ä¹ˆ`return`æ–¹æ³•ä¼šå¯¼è‡´ç«‹åˆ»è¿›å…¥`finally`ä»£ç å—ï¼Œæ‰§è¡Œå®Œä»¥åï¼Œæ•´ä¸ªå‡½æ•°æ‰ä¼šç»“æŸã€‚

```javascript
function* numbers () {
  yield 1;
  try {
    yield 2;
    yield 3;
  } finally {
    yield 4;
    yield 5;
  }
  yield 6;
}
var g = numbers();
g.next() // { value: 1, done: false }
g.next() // { value: 2, done: false }
g.return(7) // { value: 4, done: false } 
g.next() // { value: 5, done: false }
g.next() // { value: 7, done: true }
```

â€‹	ä¸Šé¢ä»£ç ä¸­ï¼Œè°ƒç”¨`return()`æ–¹æ³•åï¼Œå°±å¼€å§‹æ‰§è¡Œ`finally`ä»£ç å—ï¼Œä¸æ‰§è¡Œ`try`é‡Œé¢å‰©ä¸‹çš„ä»£ç äº†ï¼Œç„¶åç­‰åˆ°`finally`ä»£ç å—æ‰§è¡Œå®Œï¼Œå†è¿”å›`return()`æ–¹æ³•æŒ‡å®šçš„è¿”å›å€¼ã€‚

- yield* è¡¨è¾¾å¼ä¸é€’å½’ Generator å‡½æ•°

  -  å¦‚æœåœ¨ Generator å‡½æ•°å†…éƒ¨ï¼Œè°ƒç”¨å¦ä¸€ä¸ª Generator å‡½æ•°ã€‚ç›´æ¥è°ƒç”¨æ˜¯æ²¡ç”¨çš„ï¼Œéœ€è¦åœ¨å‰è€…çš„å‡½æ•°ä½“å†…éƒ¨ï¼Œè‡ªå·±æ‰‹åŠ¨å®Œæˆéå†ã€‚ 
  -  ES6 æä¾›äº†`yield*`è¡¨è¾¾å¼ï¼Œä½œä¸ºè§£å†³åŠæ³•ï¼Œç”¨æ¥åœ¨ä¸€ä¸ª Generator å‡½æ•°é‡Œé¢æ‰§è¡Œå¦ä¸€ä¸ª Generator å‡½æ•°ã€‚ 

  ```js
  // é€’å½’ Generator å‡½æ•°ï¼šåœ¨ Generator å‡½æ•°å†…éƒ¨è°ƒç”¨ Generator å‡½æ•°
  
  function* gen1() {
      yield 'a'
      yield 'b'
  }
  function* gen2() {
      yield 1
      yield* gen1()
      yield 2
  }
  var obj = gen2()
  console.log(obj.next())// {value: 1, done: false}
  console.log(obj.next())// {value: "a", done: false}
  console.log(obj.next())// {value: "b", done: false}
  console.log(obj.next())// {value: 2, done: false}
  console.log(obj.next())// {value: undefined, done: true}
  ```

- ç”¨ yield* è¿›è¡Œé€’å½’è°ƒç”¨

  ```js
  function* enumerateArray(array) {
      if (Array.isArray(array)) {
          for (let i = 0; i < array.length; i++) {
              yield* enumerateArray(array[i])
          }
      } else {
          yield array
      }
  }
  var arr = [1,2,[3,4,[5,6,[7,8]]]]
  for (var value of enumerateArray(arr)) {
      console.log(value)
  }
  ```

- ä½œä¸ºå¯¹è±¡å±æ€§çš„ Generator å‡½æ•°

  - å¦‚æœä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ˜¯ Generator å‡½æ•°ï¼Œå¯ä»¥ç®€å†™æˆä¸‹é¢çš„å½¢å¼ã€‚

    ```javascript
    let obj = {
      * myGeneratorMethod() {
        Â·Â·Â·
      }
    };
    ```

    ä¸Šé¢ä»£ç ä¸­ï¼Œ`myGeneratorMethod`å±æ€§å‰é¢æœ‰ä¸€ä¸ªæ˜Ÿå·ï¼Œè¡¨ç¤ºè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ª Generator å‡½æ•°ã€‚

    å®ƒçš„å®Œæ•´å½¢å¼å¦‚ä¸‹ï¼Œä¸ä¸Šé¢çš„å†™æ³•æ˜¯ç­‰ä»·çš„ã€‚

    ```javascript
    let obj = {
      myGeneratorMethod: function* () {
        // Â·Â·Â·
      }
    };
    ```

- Generator å‡½æ•°çš„ this

  - Generator å‡½æ•°æ€»æ˜¯è¿”å›ä¸€ä¸ªéå†å™¨ï¼ŒES6 è§„å®šè¿™ä¸ªéå†å™¨æ˜¯ Generator å‡½æ•°çš„å®ä¾‹ï¼Œä¹Ÿç»§æ‰¿äº† Generator å‡½æ•°çš„`prototype`å¯¹è±¡ä¸Šçš„æ–¹æ³•ã€‚

    ```javascript
    function* g() {}
    
    g.prototype.hello = function () {
      return 'hi!';
    };
    
    let obj = g();
    
    obj instanceof g // true
    obj.hello() // 'hi!'
    ```

    ä¸Šé¢ä»£ç è¡¨æ˜ï¼ŒGenerator å‡½æ•°`g`è¿”å›çš„éå†å™¨`obj`ï¼Œæ˜¯`g`çš„å®ä¾‹ï¼Œè€Œä¸”ç»§æ‰¿äº†`g.prototype`ã€‚ä½†æ˜¯ï¼Œå¦‚æœæŠŠ`g`å½“ä½œæ™®é€šçš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸ä¼šç”Ÿæ•ˆï¼Œå› ä¸º`g`è¿”å›çš„æ€»æ˜¯éå†å™¨å¯¹è±¡ï¼Œè€Œä¸æ˜¯`this`å¯¹è±¡ã€‚

    ```javascript
    function* g() {
      this.a = 11;
    }
    
    let obj = g();
    obj.next();
    obj.a // undefined
    ```

    ä¸Šé¢ä»£ç ä¸­ï¼ŒGenerator å‡½æ•°`g`åœ¨`this`å¯¹è±¡ä¸Šé¢æ·»åŠ äº†ä¸€ä¸ªå±æ€§`a`ï¼Œä½†æ˜¯`obj`å¯¹è±¡æ‹¿ä¸åˆ°è¿™ä¸ªå±æ€§ã€‚

    Generator å‡½æ•°ä¹Ÿä¸èƒ½è·Ÿ`new`å‘½ä»¤ä¸€èµ·ç”¨ï¼Œä¼šæŠ¥é”™ã€‚

    ```javascript
    function* F() {
      yield this.x = 2;
      yield this.y = 3;
    }
    
    new F()
    // TypeError: F is not a constructor
    ```

    ä¸Šé¢ä»£ç ä¸­ï¼Œ`new`å‘½ä»¤è·Ÿæ„é€ å‡½æ•°`F`ä¸€èµ·ä½¿ç”¨ï¼Œç»“æœæŠ¥é”™ï¼Œå› ä¸º`F`ä¸æ˜¯æ„é€ å‡½æ•°ã€‚

    ä¸‹é¢æ˜¯ä¸€ä¸ªå˜é€šæ–¹æ³•ã€‚é¦–å…ˆï¼Œç”Ÿæˆä¸€ä¸ªç©ºå¯¹è±¡ï¼Œä½¿ç”¨`call`æ–¹æ³•ç»‘å®š Generator å‡½æ•°å†…éƒ¨çš„`this`ã€‚è¿™æ ·ï¼Œæ„é€ å‡½æ•°è°ƒç”¨ä»¥åï¼Œè¿™ä¸ªç©ºå¯¹è±¡å°±æ˜¯ Generator å‡½æ•°çš„å®ä¾‹å¯¹è±¡äº†ã€‚

    ```javascript
    function* F() {
      this.a = 1;
      yield this.b = 2;
      yield this.c = 3;
    }
    var obj = {};
    var f = F.call(obj);
    
    f.next();  // Object {value: 2, done: false}
    f.next();  // Object {value: 3, done: false}
    f.next();  // Object {value: undefined, done: true}
    
    obj.a // 1
    obj.b // 2
    obj.c // 3
    ```

    ä¸Šé¢ä»£ç ä¸­ï¼Œé¦–å…ˆæ˜¯`F`å†…éƒ¨çš„`this`å¯¹è±¡ç»‘å®š`obj`å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å®ƒï¼Œè¿”å›ä¸€ä¸ª Iterator å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡æ‰§è¡Œä¸‰æ¬¡`next`æ–¹æ³•ï¼ˆå› ä¸º`F`å†…éƒ¨æœ‰ä¸¤ä¸ª`yield`è¡¨è¾¾å¼ï¼‰ï¼Œå®Œæˆ F å†…éƒ¨æ‰€æœ‰ä»£ç çš„è¿è¡Œã€‚è¿™æ—¶ï¼Œæ‰€æœ‰å†…éƒ¨å±æ€§éƒ½ç»‘å®šåœ¨`obj`å¯¹è±¡ä¸Šäº†ï¼Œå› æ­¤`obj`å¯¹è±¡ä¹Ÿå°±æˆäº†`F`çš„å®ä¾‹ã€‚

- Generator ä¸çŠ¶æ€æœº

  - Generator æ˜¯å®ç°çŠ¶æ€æœºçš„æœ€ä½³ç»“æ„ã€‚æ¯”å¦‚ï¼Œä¸‹é¢çš„`clock`å‡½æ•°å°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºã€‚

    ```javascript
    var ticking = true;
    var clock = function() {
      if (ticking)
        console.log('Tick!');
      else
        console.log('Tock!');
      ticking = !ticking;
    }
    ```

    ä¸Šé¢ä»£ç çš„`clock`å‡½æ•°ä¸€å…±æœ‰ä¸¤ç§çŠ¶æ€ï¼ˆ`Tick`å’Œ`Tock`ï¼‰ï¼Œæ¯è¿è¡Œä¸€æ¬¡ï¼Œå°±æ”¹å˜ä¸€æ¬¡çŠ¶æ€ã€‚è¿™ä¸ªå‡½æ•°å¦‚æœç”¨ Generator å®ç°ï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·ã€‚

    ```javascript
    var clock = function* () {
      while (true) {
        console.log('Tick!');
        yield;
        console.log('Tock!');
        yield;
      }
    };
    ```

    ä¸Šé¢çš„ Generator å®ç°ä¸ ES5 å®ç°å¯¹æ¯”ï¼Œå¯ä»¥çœ‹åˆ°å°‘äº†ç”¨æ¥ä¿å­˜çŠ¶æ€çš„å¤–éƒ¨å˜é‡`ticking`ï¼Œè¿™æ ·å°±æ›´ç®€æ´ï¼Œæ›´å®‰å…¨ï¼ˆçŠ¶æ€ä¸ä¼šè¢«éæ³•ç¯¡æ”¹ï¼‰ã€æ›´ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³ï¼Œåœ¨å†™æ³•ä¸Šä¹Ÿæ›´ä¼˜é›…ã€‚Generator ä¹‹æ‰€ä»¥å¯ä»¥ä¸ç”¨å¤–éƒ¨å˜é‡ä¿å­˜çŠ¶æ€ï¼Œæ˜¯å› ä¸ºå®ƒæœ¬èº«å°±åŒ…å«äº†ä¸€ä¸ªçŠ¶æ€ä¿¡æ¯ï¼Œå³ç›®å‰æ˜¯å¦å¤„äºæš‚åœæ€ã€‚

### é€šè¿‡ Generator å‡½æ•°çš„å¼‚æ­¥åº”ç”¨

åœ¨ Generator å‡½æ•°å‡ºç°å‰ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨çš„æ˜¯å›è°ƒå‡½æ•°æ¥å¤„ç†å¼‚æ­¥äº‹ä»¶ï¼Œä½†æ˜¯è¿™æ ·å¦‚æœå‡ºç°å¤šé‡åµŒå¥—ï¼Œå°±ä¼šå‡ºç°å›è°ƒåœ°ç‹±ï¼ˆå¯ä»¥å‚è§ Nodejs çš„æ–‡æ¡£äº†è§£å›è°ƒåœ°ç‹±ï¼‰ã€‚Promise å°±æ˜¯ä¸ºäº†è§£å†³å›è°ƒåœ°ç‹±è€Œå‡ºç°çš„ï¼Œä½†æ˜¯Promise çš„å†™æ³•åªæ˜¯å›è°ƒå‡½æ•°çš„æ”¹è¿›ï¼Œä½¿ç”¨`then`æ–¹æ³•ä»¥åï¼Œå¼‚æ­¥ä»»åŠ¡çš„ä¸¤æ®µæ‰§è¡Œçœ‹å¾—æ›´æ¸…æ¥šäº†ï¼Œé™¤æ­¤ä»¥å¤–ï¼Œå¹¶æ— æ–°æ„ã€‚

Promise çš„æœ€å¤§é—®é¢˜æ˜¯ä»£ç å†—ä½™ï¼ŒåŸæ¥çš„ä»»åŠ¡è¢« Promise åŒ…è£…äº†ä¸€ä¸‹ï¼Œä¸ç®¡ä»€ä¹ˆæ“ä½œï¼Œä¸€çœ¼çœ‹å»éƒ½æ˜¯ä¸€å †`then`ï¼ŒåŸæ¥çš„è¯­ä¹‰å˜å¾—å¾ˆä¸æ¸…æ¥šã€‚

- åç¨‹

  - ä¼ ç»Ÿçš„ç¼–ç¨‹è¯­è¨€ï¼Œæ—©æœ‰å¼‚æ­¥ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆï¼ˆå…¶å®æ˜¯å¤šä»»åŠ¡çš„è§£å†³æ–¹æ¡ˆï¼‰ã€‚å…¶ä¸­æœ‰ä¸€ç§å«åš"åç¨‹"ï¼ˆcoroutineï¼‰ï¼Œæ„æ€æ˜¯å¤šä¸ªçº¿ç¨‹äº’ç›¸åä½œï¼Œå®Œæˆå¼‚æ­¥ä»»åŠ¡ã€‚

    åç¨‹æœ‰ç‚¹åƒå‡½æ•°ï¼Œåˆæœ‰ç‚¹åƒçº¿ç¨‹ã€‚å®ƒçš„è¿è¡Œæµç¨‹å¤§è‡´å¦‚ä¸‹ã€‚

    - ç¬¬ä¸€æ­¥ï¼Œåç¨‹`A`å¼€å§‹æ‰§è¡Œã€‚
    - ç¬¬äºŒæ­¥ï¼Œåç¨‹`A`æ‰§è¡Œåˆ°ä¸€åŠï¼Œè¿›å…¥æš‚åœï¼Œæ‰§è¡Œæƒè½¬ç§»åˆ°åç¨‹`B`ã€‚
    - ç¬¬ä¸‰æ­¥ï¼Œï¼ˆä¸€æ®µæ—¶é—´åï¼‰åç¨‹`B`äº¤è¿˜æ‰§è¡Œæƒã€‚
    - ç¬¬å››æ­¥ï¼Œåç¨‹`A`æ¢å¤æ‰§è¡Œã€‚

    ä¸Šé¢æµç¨‹çš„åç¨‹`A`ï¼Œå°±æ˜¯å¼‚æ­¥ä»»åŠ¡ï¼Œå› ä¸ºå®ƒåˆ†æˆä¸¤æ®µï¼ˆæˆ–å¤šæ®µï¼‰æ‰§è¡Œã€‚

    ä¸¾ä¾‹æ¥è¯´ï¼Œè¯»å–æ–‡ä»¶çš„åç¨‹å†™æ³•å¦‚ä¸‹ã€‚

    ```javascript
    function* asyncJob() {
      // ...å…¶ä»–ä»£ç 
      var f = yield readFile(fileA);
      // ...å…¶ä»–ä»£ç 
    }
    ```

    ä¸Šé¢ä»£ç çš„å‡½æ•°`asyncJob`æ˜¯ä¸€ä¸ªåç¨‹ï¼Œå®ƒçš„å¥¥å¦™å°±åœ¨å…¶ä¸­çš„`yield`å‘½ä»¤ã€‚å®ƒè¡¨ç¤ºæ‰§è¡Œåˆ°æ­¤å¤„ï¼Œæ‰§è¡Œæƒå°†äº¤ç»™å…¶ä»–åç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`yield`å‘½ä»¤æ˜¯å¼‚æ­¥ä¸¤ä¸ªé˜¶æ®µçš„åˆ†ç•Œçº¿ã€‚

    åç¨‹é‡åˆ°`yield`å‘½ä»¤å°±æš‚åœï¼Œç­‰åˆ°æ‰§è¡Œæƒè¿”å›ï¼Œå†ä»æš‚åœçš„åœ°æ–¹ç»§ç»­å¾€åæ‰§è¡Œã€‚å®ƒçš„æœ€å¤§ä¼˜ç‚¹ï¼Œå°±æ˜¯ä»£ç çš„å†™æ³•éå¸¸åƒåŒæ­¥æ“ä½œï¼Œå¦‚æœå»é™¤`yield`å‘½ä»¤ï¼Œç®€ç›´ä¸€æ¨¡ä¸€æ ·ã€‚

- åç¨‹çš„ Generator å‡½æ•°å®ç°

  - Generator å‡½æ•°æ˜¯åç¨‹åœ¨ ES6 çš„å®ç°ï¼Œæœ€å¤§ç‰¹ç‚¹å°±æ˜¯å¯ä»¥äº¤å‡ºå‡½æ•°çš„æ‰§è¡Œæƒï¼ˆå³æš‚åœæ‰§è¡Œï¼‰ã€‚

    æ•´ä¸ª Generator å‡½æ•°å°±æ˜¯ä¸€ä¸ªå°è£…çš„å¼‚æ­¥ä»»åŠ¡ï¼Œæˆ–è€…è¯´æ˜¯å¼‚æ­¥ä»»åŠ¡çš„å®¹å™¨ã€‚å¼‚æ­¥æ“ä½œéœ€è¦æš‚åœçš„åœ°æ–¹ï¼Œéƒ½ç”¨`yield`è¯­å¥æ³¨æ˜ã€‚Generator å‡½æ•°çš„æ‰§è¡Œæ–¹æ³•å¦‚ä¸‹ã€‚

    ```javascript
    function* gen(x) {
      var y = yield x + 2;
      return y;
    }
    
    var g = gen(1);
    g.next() // { value: 3, done: false }
    g.next() // { value: undefined, done: true }
    ```

    ä¸Šé¢ä»£ç ä¸­ï¼Œè°ƒç”¨ Generator å‡½æ•°ï¼Œä¼šè¿”å›ä¸€ä¸ªå†…éƒ¨æŒ‡é’ˆï¼ˆå³éå†å™¨ï¼‰`g`ã€‚è¿™æ˜¯ Generator å‡½æ•°ä¸åŒäºæ™®é€šå‡½æ•°çš„å¦ä¸€ä¸ªåœ°æ–¹ï¼Œå³æ‰§è¡Œå®ƒä¸ä¼šè¿”å›ç»“æœï¼Œè¿”å›çš„æ˜¯æŒ‡é’ˆå¯¹è±¡ã€‚è°ƒç”¨æŒ‡é’ˆ`g`çš„`next`æ–¹æ³•ï¼Œä¼šç§»åŠ¨å†…éƒ¨æŒ‡é’ˆï¼ˆå³æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„ç¬¬ä¸€æ®µï¼‰ï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªé‡åˆ°çš„`yield`è¯­å¥ï¼Œä¸Šä¾‹æ˜¯æ‰§è¡Œåˆ°`x + 2`ä¸ºæ­¢ã€‚

    æ¢è¨€ä¹‹ï¼Œ`next`æ–¹æ³•çš„ä½œç”¨æ˜¯åˆ†é˜¶æ®µæ‰§è¡Œ`Generator`å‡½æ•°ã€‚æ¯æ¬¡è°ƒç”¨`next`æ–¹æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºå½“å‰é˜¶æ®µçš„ä¿¡æ¯ï¼ˆ`value`å±æ€§å’Œ`done`å±æ€§ï¼‰ã€‚`value`å±æ€§æ˜¯`yield`è¯­å¥åé¢è¡¨è¾¾å¼çš„å€¼ï¼Œè¡¨ç¤ºå½“å‰é˜¶æ®µçš„å€¼ï¼›`done`å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤º Generator å‡½æ•°æ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œå³æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚

### async

ES2017 æ ‡å‡†å¼•å…¥äº† async å‡½æ•°ï¼Œä½¿å¾—å¼‚æ­¥æ“ä½œå˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚async å‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿä¸€å¥è¯ï¼Œå®ƒå°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚åªæœ‰ä¸€éƒ¨åˆ†æµè§ˆå™¨æ”¯æŒ ES7 è¯­æ³•

```js
// async æå‡ºä»¥å‰
function timeout(ms) {
    return new Promise((reslove, reject) => {
        //setTimeout(reslove, ms)
        if (ms % 2 == 0) {
            setTimeout(reslove, ms)
        } else {
            // å¿…é¡»ç”¨ reject æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœç›´æ¥æŠ›å‡ºï¼Œé‚£ä¹ˆ async å’Œ promise çš„ catch éƒ½ä¸ä¼šæ•è·å¼‚å¸¸
            reject(new Error('å»¶æ—¶æ—¶é—´å¿…é¡»ä¸ºå¶æ•°'))
        }
    })
}
timeout(2000).then(() => {
    console.log('111')
}).catch((err) => {
    console.log(err)
})
```

- async æ–¹æ³•æ‰§è¡Œä¸Šé¢æ–¹æ³•

  ```js
  async function asyncPrint(value, ms) {
      // å½“ promise çŠ¶æ€ä¸€è½¬æ¢ä¸º reslove ï¼Œå³resloveæ–¹æ³•ä¸€è¢«è°ƒç”¨å°±ç»§ç»­æ‰§è¡Œ
      try{
      	await timeout(ms).then(()=>{console.log('111')})
      	console.log(value)
      } catch(err) {
          console.log(err)
      }
  }
  asyncPrint('hello world', 3000)
  ```

  









