# 深入的了解GIT

## Git简介

- Git发展历史

Linus在1991年创建了开源Linux，在Git诞生之前，开发者通过diff方式把Linux源码发送给Linus，然后Linus本人通过手工方式合并代码。这种方式十分的繁琐和复杂。

当时开发者使用的是CVS、SVN集中式版本控制系统（集中式的版本控制系统不但速度慢，而且必须联网才能使用），BitKeeper授权免费使用，但是遭遇破解Bitkeeper协议。Linus花了两周自己用C写了一个分布式版本控制系统。Git在一个月后接管Linux源码管理。 2008年 Github网站上线。

- Git版本控制特性

Git通过用户自定义标记来进行版本控制，既可以继续新建，也可以直接回退。

- Git分布式控制

中央服务器，提供仓库下载和上传功能。每一个工作电脑都可以克隆服务器上完整项目代码。

![点击查看源网页](https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3363650327,139984655&fm=26&gp=0.jpg)

- 集中与分布控制区别

  - 中央服务器，提供仓库下载和上传功能。当中央服务器奔溃就无法工作了。只有中央服务器上有完整代码。
  - 中央服务器，提供仓库下载和上传功能。当中央服务器奔溃就可以继续。只要克隆过服务器上项目代码。

## Git安装

- Windows
  - Git官网：https://git-scm.com/
  - 安装就可以了
  - 在Git官网：https://git-scm.com/docs 获取命令帮助信息。
- Linux
  - Linux下使用 `apt-get install git` 安装Git。
  - 安装完成之后，输入git确保安装成功。

## Git原理

- Git三种状态

这节将介绍Git工作区、暂存区、版本库，这个三种状态。

Git几乎所有的操作都是在本地完成，本地完成之后再进行上传。其中本地三种状态可以
进行切换，实现版本控制。

![1](.\1.png)

- Git使用流程
- 
    1. Git版本库初始化
    
    2. 在工作目录中修改文件。
    
    3. 暂存文件，将文件的快照放入暂存区域。
    
    4. 提交更新，找到暂存区域的文件，将快照永久性存储到 Git 仓库目录。

    Git 有多种使用方式。 你可以使用原生的命令行模式，也可以使用 GUI 模式，这些 GUI 软件也能提供多种功能。不同的人常常会安装不同的 GUI 软件，但 所有 人一定会有命令行工具。
    
- Git初始化版本库

在Git命令行中，新建一个目录，要来保存Git仓库。使用git init初始化仓库。期间使用`ls -alh` 查看区别。

![2](.\2.png)

- 使用Git版本库

一般情况下，针对提交版本库内容可以通过以下命令：
1、编辑文件
2、将文件提交到暂存区 `git add` 文件名
3、将文件提交版本库 `git commit -m '版本信息'`

## Git配置

- Git初始化配置文件

  - 既然已经在系统上安装了 Git，你会想要做几件事来定制你的 Git 环境。 每台计算机上只需要配置一次，程序升级时会保留配置信息。 你可以在任何时候再次通过运行命令来修改它们。
    - 、/etc/gitconfig 文件: 包含系统上每一个用户及他们仓库的通用配置。 如果使用带有--system 选项的 git config 时，它会从此文件读写配置变量。
    - ~/.gitconfig 或 ~/.config/git/config 文件：只针对当前用户。 可以传递 --global选项让 Git 读写此文件。
    - 当前使用仓库的 Git 目录中的 config 文件（就是 .git/config）：针对该仓库。每一个级别覆盖上一级别的配置，所以 .git/config 的配置变量会覆盖 /etc/gitconfig 中的配置变量。

- Git配置用户信息

  - 当安装完 Git 应该做的第一件事就是设置你的用户名称与邮件地址。 这样做很重要，因为每一个 Git 的提交都会使用这些信息，并且它会写入到你的每一次提交中，不可更改：
    `$ git config --global user.name "Your name" `

    `$ git config --global user.email test@example.com`

    如果使用了 --global 选项，那么该命令只需要运行一次，因为之后无论你在该系统上做任何事情， Git 都会使用那些信息。 当你想针对特定项目使用不同的用户名称与邮件地址时，可以在那个项目目录下运行没有 --global 选项的命令来配置。
  
  - 注：配置完邮箱之后，提交代码过程中不会发送邮件到用户配置的邮箱中，而是把用户名和邮箱写入到提交的代码中，方便查找。
  
- Git查看配置信息

如果想要检查你的配置，可以使用 `git config --list` 命令来列出所有 Git 当时能找到的配置，如果想要检查你的具体配置，可以使用 `git config 具体选项 ` 命令来列出。

## Git回退

- Git远程仓库使用

  - 如果想获得一份已经存在了的 Git 仓库的拷贝，比如说，想为某个开源项目贡献自己的一份力，这时就要用到 git clone 命令。执行 git clone 命令的时候，默认配置下远程 Git 仓库中的每一个文件的每一个版本都将
    被拉取下来。克隆仓库的命令格式是 git clone [url] 。
    `git clone https://github.com/Jamsdfn/wweebb`

- Git回退版本

当项目开发多次迭代之后，会在Git中记录多个版本的项目。如果想在开发过程中直接回退到之前的版本。在Git中可以使用git reset来实现。在Git中HEAD始终指向当前版本。HEAD^ 前一个版本、HEAD^^ 前两个版本、HEAD~n前n个版本回退到上一个版本的Git命令：
  `git reset --hard HEAD~1 或 HEAD^`

![3](.\3.png)

- Git版本编号

git log 获取对应的版本编号，`git reset --hard 版本编号`，回退到指定版本的位置。

![4](.\4.png)

如果版本退回后不小心把终端关闭，但又想回到回退前的版本，那么就可以用Git查找历史版本编号的方法，找回那个版本的编号，重新 reset 。

- Git查找历史版本编号

`git reflog` 查看操作记录，并能找到对应的编号。

通过版本编号的前七个字母就可以实现回退。

![5](.\5.png)

## Git撤销

- Git状态查看

在git下，工作在三个区中，时常需要查看三个区的状态。在Git下使用git status来查看。

![6](.\6.png)

如果在工作区修改，使用git status会出现以下情况。

![7](.\7.png)

- Git撤销工作区修改

在Git工作区重新编辑了已经提交过hello.py，此时新编辑的内容并没有被添加和提交（没有 add 没有 commit）。但是又不需要新添加的内容，可使用`git checkout -- 文件名` 直接删除修改(即把这个文件变回上一次提交的状态，新修改的内容将被撤销)。

![8](.\8.png)

- Git撤销暂存区修改

Git中的文件，修改并已经添加到暂存区（已经 git add 过了），但并没有进行commit提交。这时候可以使用以下方法进行撤销：`git reset HEAD 文件名` 即退回到了工作区（git add 之前）

![9](.\9.png)

注：如果 commit 了，想要撤销，就要用到上一点的内容，版本回退。

- Git版本记录简化

在Git下 使用`git log`查看版本记录但是比较冗余，可以使用 `git log --pretty=oneline`简化记录。

![10](.\10.png)

## Git删除

- Git状态变化周期

下面给出变化周期示意图。 使用`git status`查看状态

![11](.\11.png)

- Linux rm删除文件

在Linux下可以使用 `rm`命令删除系统中的文件或目录。一般情况下用来删除未被untracked的文件。

无法恢复。同理 Windows。只能通过磁盘恢复工具恢复了。

![12](.\12.png)

- Git rm删除文件

使用`git rm`后，下一次提交时，该文件就不再纳入版本管理了。 如果删除之前修改过并且已经放到暂存区域的话，则必须要用强制删除选项 -f（译注：即 force 的首字母）。这样的数据不能被 Git 恢复

![13](.\13.png)

- Git 状态简化查看

Git下的 `git status` 很详细的展示状态改变，但是如果状态很多，那么直接显示就比较复制。可以使用  `git status -s` 简化。新添加的未跟踪文件前面有 ?? 标记，新添加到暂存区中的文件前面有 A 标记，修改过的文件前面有 M 标记。 你可能注意到了 M 有两个可以出现的位置，出现在右边的 M 表示该文件被修改了但是还没放入暂存区，出现在靠左边的 M 表示该文件被修改了并放入了暂存区。

![14](.\14.png)

## Git比较

- Git查看工作区文件不同

使用`git diff `查看工作区文件内容不同。

![15](.\15.png)

- Git查看暂存区不同

在Git下 使用 `git diff --staged `查看暂存区中文件不同。

![16](.\16.png)

- Git对比不同状态文件

使用 `git diff HEAD -- 文件`  对比提交版本中文件与当前工作区文件不同

![17](.\17.png)

- Git对比不同版本不同

Git下对比两个版本中某个文件不同`git  diff HEAD HEAD^ -- 文件`

![18](.\18.png)

## Git分支介绍

- Git分支概念

几乎所有的版本控制系统都以某种形式支持分支。使用分支意味着可以把工作从开发主线中分离开以免影响开发主线。

- Git分支在实际使用

假设 目前项目需要开发新功能，但是你目前开发了40%，如果立刻提交会造成别人无法正常工作。如果代码在写完之后一并提交，又丢失每天进度（指的是别人不知道你开发的进度）。

解决方法：创建属于自己的分支，别人在原来分支工作，互补影响。直到开发完成合并分支完成项目。

所有人都在一个分支工作，那么只要有一个功能块没有完成，很有可能影响整个项目的进展。

- Git中HEAD介绍

默认情况下，Git创建一条主分支（master）。而HEAD是只想master分支的一个“指针”。实际上HEAD是指向当前工作分支。

- 默认分支介绍

在Git中，以master为开发主线，后期分支合并也是直接合并到master主分支。

可以使用 `git branch` 命令查看当前HEAD指向的分支。

## Git分支基本操作

- Git分支创建

在Git中使用  `git branch 分支名` 创建一个分支，使用 `git checkout 分支名` 切换分支。

在Git中使用  `git checkout -b 分支名` 直接完成创建与切换。

![19](.\19.png)

- Git分支创建原理

在进行创建分支过程中，只是在原有基础上新建一个分支名称。

- Git分支合并
  - 快速合并：直接将分支合并到主分支中。Fast-forward（直接合并到 master 主分支）. `git merge 分支名`。只出现 `Already up to data ` 合并还没有成功，要切换别的分支才能合并这个分支的代码。出现了类似下面的那段代码才算合并成功。
  
  ```shell
  66666@DESKTOP-66666 MINGW64 /d/git_test (master)
  $ git merge new2
  Updating 4fcf9e5..a4e0f4c
  Fast-forward
   3.py | 0
   1 file changed, 0 insertions(+), 0 deletions(-)
   create mode 100644 3.py
  ```
  
  
  
  - 合并完成之后，需要删除new分支。注意：在Git中必须将分支切换到其他分支，才可以删除当前分支。否则出现以下情况： （使用`git branch master`，然后删除其他分支）

![20](.\20.png)

- Git分支合并原理

合并的实质就是将分支内容迁移到master主分支，但是合并完成之后，当前工作分支没有改变。

## Git分支合并

- Git快速合并

一般情况下，Git下快速合并用于合并其他分支上修改了主分支对应文件，但是master主分支既可以修改也可以不修改对应文件。默认使用 ` git  merge 分支名 `使用快速合并。 也就是上节最后一点说的内容。

- Git快速合并冲突

  - 在Git中，如果在主分支中修改文件test.txt并提交，也在其他分支中修改test.txt文件。那么就会出现合并冲突。无法合并。

  - 解决方案：在test.txt文件中，做修改，再提交。不建议在多个分支中修改同一个文件。

  ![22](.\22.png)

- Git策略合并

策略合并用于主分支与其他分支修改不同文件提交后，进行合并。

![23](.\23.png)

- Git快速以及策略合并区别

快速合并于策略合并的主要区别在于是否在合并之后进行了对应的提交。默认情况 使用快速合并，也可以在实际情况下指定使用策略合并  --no-ff

![21](.\21.png)

## Github仓库创建

- Github介绍
  - gitHub是一个面向开源及私有软件项目的托管平台，因为只支持git 作为唯一的版本库格
    式进行托管，故名gitHub。
  - 版本控制中，需要有中央服务器进行代码管理。那么中央服务器既可以自行搭建，也可
    以使用Github进行搭建。

## Github添加SSH用户并连接

- Git配置邮箱与用户名

登录Github需要使用对应的用户名和密码。其中用户名需要配置 邮箱和 github用户名。配置位置在 用户目录下的 .gitconfig文件中，可以直接修改文件内容或使用 命令配置。

- 生成密钥

用`ssh-keggen -t rsa -C "注册Github的邮箱"` 来生成密钥,生成的密钥保存在 .ssh 目录下, .ssh 目录的路径可以在生成密钥过程中根据提示来设置。（-t rsa 表示加密方式为 rsa ）

- Github添加SSH用户

在Github中可以直接通过界面进行SSH用户添加，点击后会有一个 key 的输入域，把 .ssh 里的id_rsa.pub的全部字符复制过去就可以了。注：在Github中添加生成的公钥即上述的 .pub 的文件。

![24](.\24.png)

- 克隆连接仓库

可以直接克隆远程的github仓库，进行代码开发。使用 `git clone `命令克隆。

`git clone https://github.com/username/Repositories`

## Github项目代码开发

- Github推送代码

在Git中使用  `git push origin 分支名称` 将本地分支所有内容推送到远程库中。

- Github远程跟踪

设置本地分支跟踪远程分支。使用   `git branch --set-upstream-to=origin/远程分支名称 本地分支名称`

设置完成之后，可以直接使用  git push推送代码。不需要指定分支名称。

- Github拉取代码

从Github项目分支中拉取代码到本地。使用 `git pull origin 分支名称`

- Git工作流程

项目经理：

1、搭建项目框架，把框架发送到服务器。

2、将员工的SSH公钥添加到服务器。

普通员工：

1、生成SSH公钥，发送给项目经理

2、收到项目经理项目地址，git clone 代码

3、本地创建分支，开发代码，把代码发送到远程服务器。

一般情况下，master分支用来保存发布的项目，dev分支用来保存开发过程中代码。

## Git信息泄露

- Git信息泄露介绍

在未知情况下，程序泄露了敏感信息（用户账号密码、程序源代码）。

Git信息泄露就是 通过Git导致程序源代码泄露。在源代码中可以找到各种敏感信息，例如内容IP、数据库连接信息等。

- Git信息泄露利用原理

默认情况下，所有的Git 初始化都会在目录下创建.git文件夹，用来存储对应配置文件信息。

​	解析.git/index文件，找到工程中所有的： ( 文件名，文件sha1 )

​	去.git/objects/ 文件夹下下载对应的文件

​	zlib解压文件，按原始的目录结构写入源代码。

- Git信息泄露环境搭建

在本地网站根目录粘贴存在.git目录的文件夹，完成搭建。

- Git信息泄露利用

使用GitHack利用.git信息泄露获取源码文件。注意：防御措施，在上线项目代码中删除.git文件夹，避免git造成的信息泄露。

## Github 删除对应的仓库

实际过程中，某些仓库在开发过程中只用于测试，测试完成之后，该仓库就没有作用。此时就可以在Github上删除该仓库。

![25](.\25.png)

